---
stepsCompleted: [1, 2, 3, 4]
inputDocuments:
  - '_bmad-output/planning-artifacts/prd.md'
  - '_bmad-output/planning-artifacts/ux-design-specification.md'
  - 'c:\\Users\\TingYi\\Downloads\\Architecture.md'
completedAt: "2026-01-27"
---

# 昶青_碼頭系統 - Epic Breakdown

## Overview

This document provides the complete epic and story breakdown for 昶青_碼頭系統, decomposing the requirements from the PRD, UX Design if it exists, and Architecture requirements into implementable stories.

## Requirements Inventory

### Functional Requirements

FR1: 倉儲人員可以使用後台帳號密碼登入系統
FR2: 系統可以驗證登入憑證，並在驗證失敗時顯示錯誤提示
FR3: 倉儲人員可以查看忘記密碼的相關資訊
FR4: 倉儲人員可以安全登出系統
FR5: 系統可以根據登入人員的內部廠區設定，只顯示符合該廠區的資料
FR6: 系統可以整合後台碼頭人員列表進行身份驗證
FR7: 倉儲人員可以查看公告列表
FR8: 倉儲人員可以篩選公告列表
FR9: 倉儲人員可以標記公告為已讀
FR10: 倉儲人員可以刪除公告
FR11: 倉儲人員可以批量標記公告為已讀（依照篩選條件）
FR12: 倉儲人員可以批量刪除公告（依照篩選條件）
FR13: 倉儲人員可以查看公告詳細內容（日期、時間、標題、內容）
FR14: 系統可以顯示公告的已讀/未讀狀態
FR15: 倉儲人員可以查看碼頭儀錶板，顯示所屬廠區啟用中碼頭的即時狀態（碼頭來源：【碼頭管理 > 碼頭列表】，底色固定綠色）
FR16: 所屬廠區相同的碼頭人員使用相同碼頭儀錶板
FR17: 倉儲人員可以從未排車次的碼頭下拉選單中選擇車次（格式：[車牌]([車次])(任務單號)，車次抓【配送點管理 > 固定路線】該路線別所設之車次代號）
FR18: 系統可以根據條件篩選可選車次（3 項皆須符合：當天配送日期、任務起點為同廠區、該任務有任何一筆送貨），符合時任務狀態為「待出貨」
FR19: 倉儲人員選擇車次加入碼頭後，系統將該車輛任務狀態改為「碼頭處理中」
FR20: 燈箱顯示配送任務資料（上班時間、司機姓名、車號車次、路線別）及所有配送點的收送貨商品與載具詳細資訊
FR21: 狀態綁定配送任務狀態：完成出車（→ 配送中）、取消（→ 配送中）、缺貨待料（→ 缺貨待料）、通知未到（→ 通知未到）
FR22: 配送中的車輛從碼頭儀錶板與未排車次列表移除，缺貨待料／通知未到的車輛從碼頭移除但回到未排車次列表
FR23: 透過出貨日期和班別篩選未排車次列表
FR24: 不顯示任務狀態為碼頭處理中、配送中、配送異常、配送完成的車輛
FR25: 綠色：待出貨、藍色：缺貨待料、紅色：通知未到
FR25.1: 已排車次通知圖示
FR25.2: 通知未到時通知運務員及運務部主管
FR26: 倉儲人員可以查看收貨列表，顯示所有包含收貨的任務
FR27: 倉儲人員可以篩選收貨列表
FR28: 系統可以追蹤任務的下貨狀態（接貨中、回廠下貨、下貨完成）
FR29: 系統可以接收運務回報的「回廠下貨」狀態，並更新任務狀態
FR30: 系統可以顯示回廠下貨任務的車輛回報位置和時間
FR31: 倉儲人員可以為回廠下貨的任務選擇下貨碼頭
FR32: 系統可以自動排除已選定出貨和下貨的碼頭選項
FR33: 倉儲人員可以從收貨列表進入任務的配送點總表
FR34: 系統可以依照狀態和回報時間排序收貨列表（先回廠下貨再接貨中，同樣狀態依回報時間新到舊）
FR35: 倉儲人員可以查看配送點總表，顯示任務所有有收貨的配送單資訊
FR36: 倉儲人員可以從配送點總表進入收貨明細
FR37: 倉儲人員可以請運務在配送點總表簽名
FR38: 系統可以在運務簽名送出後，將任務收貨狀態更新為下貨完成
FR39: 系統可以防止收貨狀態為下貨完成的任務再次進入配送點總表
FR40: 倉儲人員可以查看入庫分貨的收貨明細
FR41: 倉儲人員可以查看越庫作業的收貨明細
FR42: 系統可以顯示收貨明細的進入時間並持續動態更新
FR43: 倉儲人員可以查看配送單的商品資訊（客戶簡稱、商品名稱、單據資訊等）
FR44: 倉儲人員可以修改入庫分貨的實收數量
FR45: 倉儲人員可以為入庫分貨的商品新增多組實收數量與有效日期
FR46: 倉儲人員可以刪除入庫分貨商品的多組實收數量與有效日期資料（最少必須保留一組）
FR47: 倉儲人員可以為入庫分貨的商品填寫備註
FR48: 倉儲人員可以修改越庫作業的實收板位
FR49: 倉儲人員可以為越庫作業的商品新增多組配送點、實收板位、配送日期與備註
FR50: 倉儲人員可以刪除越庫作業商品的多組資料（配送點、實收板位、配送日期與備註），最少必須保留一組
FR51: 倉儲人員可以為越庫作業的商品填寫備註
FR52: 倉儲人員可以查看退貨單列表，顯示運務APP【異常回報-退貨】產生的退貨單、後台【碼頭管理>退貨單列表】的退貨單、及前後台合併「未完成」退貨單產生的彙整單
FR53: 倉儲人員可以透過關鍵字、建立日期、客戶簡稱、溫層、退貨類型、狀態篩選
FR54: 系統可以顯示退貨單的關鍵資訊（退貨單號、建立日期、原配送單號、客戶簡稱、溫層、退貨類型、狀態）
FR54.1: 退貨類型為「直退」時，只顯示任務起點內部廠區同登入者所屬廠區的退貨單
FR54.2: 退貨類型為「回廠退」時，只顯示退貨廠區同登入者所屬廠區的退貨單
FR54.3: 後台[新增]的退貨單及類型為「彙整單」的退貨單，不顯示原配送單號欄位資料
FR54.4: 列表依建立日期由新到舊降冪排列
FR55: 倉儲人員可以勾選退貨單點擊彙整退貨單合併為彙整單
FR55.1: 系統驗證狀態必為未完成且同客戶簡稱同溫層
FR55.2: 單張退貨單也可建立為彙整單
FR55.3: 彙整單號規則：BA+yyyymmdd+00001
FR55.4: 彙整單類型為彙整單，狀態為待立單
FR55.5: 被合併原退貨單狀態變為已彙整
FR55.6: 彙整單同步顯示於前台及後台
FR56: 倉儲人員可以編輯狀態為未完成的退貨單
FR56.1-FR56.5: 退貨數量、新增商品燈箱、刪除規則、檔案上傳、資料連動
FR57: 倉儲人員可以查看退貨單：已彙整+回廠退，或已立單+直退
FR57.1-FR57.4: 彙整單編輯頁相關
FR58: 倉儲人員可以查看已立單+彙整單（唯讀）
FR58.1: 系統可以整合運務APP和後台退貨單資料
FR59: 系統可以即時同步後台操作到前端顯示（< 3 秒）
FR60: 系統可以即時同步前端操作到後台和其他裝置
FR61: 系統可以維持即時雙向連線，確保資料即時同步
FR62: 系統可以在網路中斷時提示使用者
FR63: 系統可以支援多裝置同時監控並保持資料同步
FR64: 系統可以發送推播通知到運務 APP
FR65: 系統可以接收運務 APP 回報的狀態（如回廠下貨）
FR66: 後台管理員可以管理碼頭列表
FR66.1: 碼頭列表搜尋功能（關鍵字搜尋碼頭名稱、所屬廠區下拉選單）
FR66.2: 碼頭列表顯示欄位：所屬廠區、碼頭名稱、啟用狀態（ON/OFF）、操作（編輯/刪除）
FR66.3: 點擊[新增]按鈕進入新增詳細頁
FR66.4: 點擊[編輯]按鈕進入編輯詳細頁
FR66.5: 未曾安排過車次的碼頭才顯示[刪除]按鈕
FR66.6: 點擊[刪除]跳出「是否確認刪除」提示燈箱
FR66.7: 碼頭新增頁欄位：所屬廠區*、碼頭名稱*
FR66.8: 碼頭編輯頁欄位同新增頁，預設帶入現有資料
FR67: 後台管理員可以管理碼頭人員列表
FR67.1: 碼頭人員列表搜尋功能（關鍵字搜尋人員姓名/帳號、所屬廠區下拉選單）
FR67.2: 碼頭人員列表顯示欄位：人員姓名、人員帳號、所屬廠區、啟用狀態（ON/OFF）、操作（編輯/刪除）
FR67.3: 點擊[新增]按鈕進入新增詳細頁
FR67.4: 點擊[編輯]按鈕進入編輯詳細頁
FR67.5: 未曾登入過的碼頭人員才顯示[刪除]按鈕
FR67.6: 點擊[刪除]跳出「是否確認刪除」提示燈箱
FR67.7: 碼頭人員新增頁欄位：所屬廠區*、碼頭人員姓名*、碼頭人員帳號*、碼頭人員密碼*、碼頭人員確認密碼*
FR67.8: 碼頭人員編輯頁欄位：所屬廠區*、碼頭人員姓名*、碼頭人員帳號*、碼頭人員密碼（選填）
FR68: 後台管理員可以查看退貨單列表
FR68.1: 退貨單列表搜尋欄位：關鍵字（退貨單號、原配送單號）、建立日期、客戶簡稱、溫層、退貨類型、退貨廠區、狀態、退貨配送單狀態
FR68.2: 退貨單列表顯示欄位：勾選格、退貨單號、建立日期、原配送單號、客戶簡稱、溫層、退貨類型、退貨廠區、狀態、退貨配送單號、退貨配送單狀態、操作
FR68.3: 列表顯示運務APP直退&回廠退退貨單、後台新增之回廠退退貨單、前後台合併未完成退貨單產生的彙整單
FR68.4: 點擊[彙整退貨單]將勾選的退貨單合併成一張彙整單（須同退貨廠區、同客戶簡稱、同溫層）
FR68.5: 彙整單號規則：BA+yyyymmdd+00001（流水號）
FR68.6: 被合併的原退貨單狀態變為「已彙整」
FR68.7: 狀態為「未完成」顯示[編輯]按鈕（進入退貨單編輯頁）；狀態為「待立單」顯示[編輯]按鈕（進入彙整單編輯頁）；狀態為「已彙整」或「已立單」顯示[查看]按鈕
FR68.8: 退貨單新增頁欄位：客戶簡稱*、溫層*、退貨類型（純顯示/回廠退）、退貨廠區*、退貨資訊、退貨單備註、檔案上傳
FR68.9: 退貨資訊表格欄位：商品名稱、退貨數量（數字框+最小單位）、備註
FR68.10: 點擊[送出]時產生退貨單號規則：B+yyyymmdd+00001，預設狀態為「未完成」
FR68.11: 退貨單編輯頁純顯示欄位：退貨單號、建立日期、原配送單號、客戶簡稱、溫層、退貨類型、退貨廠區、狀態
FR68.12: 退貨單查看頁顯示完整退貨單資訊（純顯示，不可編輯）
FR68.13: 彙整單編輯頁顯示原退貨單號（純顯示），退貨資訊預設帶入原退貨單商品（同商品合併）
FR68.14: 彙整單查看頁顯示完整彙整單資訊（純顯示）
FR69: 後台管理員可以查詢倉儲收貨資訊
FR69.1: 倉儲收貨資訊查詢搜尋欄位：關鍵字（配送任務單號）、回廠時間、收貨類型、收貨配送點、收貨廠區、客戶簡稱、處理狀態、收貨人員
FR69.2: 列表顯示欄位：回報時間、配送任務單號、類型、收貨配送點、收貨廠區、客戶簡稱、處理狀態、收貨人員、是否異動、操作
FR69.3: 相同配送任務一個貨主x配送點為一列
FR69.4: 排序規則：先依狀態（回廠下貨>接貨中>下貨完成），同狀態依回報時間降冪
FR69.5: 收貨類型於後台配送任務建立當下即紀錄於資料庫，前台直接讀取顯示
FR69.6: 處理狀態預設為「接貨中」，運務APP回報後變為「回廠下貨」，碼頭前台簽名後變為「下貨完成」
FR69.7: 是否異動預設為「否」，下貨完成後後台修改則記錄為「是」
FR69.8: 入庫分貨編輯頁純顯示欄位：回報時間、配送任務單號、類型、收貨廠區、收貨配送點、客戶簡稱、運務員簽名（圖檔）、處理狀態
FR69.9: 入庫分貨收貨資訊表格欄位：品名、單據入數、單據件數、單據板位、實收數量、有效日期、備註
FR69.10: 單據入數/件數/板位預設顯示運務APP配送單起點回報數值
FR69.11: 單筆商品可新增多組[實收數量]+[有效日期]，超過一組才顯示刪除按鈕
FR69.12: 原配送單內收貨商品不可刪除，後台新增商品才顯示刪除按鈕
FR69.13: 儲存時收貨資訊連動【碼頭前台>收貨作業>入庫分貨詳細頁】
FR69.14: 越庫作業編輯頁純顯示欄位同入庫分貨
FR69.15: 越庫作業收貨資訊表格欄位：商品名稱、起點單據板位、實收板位、備註、迄點單據板位、配送點、配送日期
FR69.16: 配送點下拉選單抓同客戶關聯所有啟用的常態配送點
FR69.17: 可新增多筆商品項目，單一商品可新增多組配送點資料
FR69.18: 原配送單內收貨商品不可刪除，後台新增商品才可刪除
FR69.19: 儲存時收貨資訊連動【碼頭前台>收貨作業>越庫作業詳細頁】
FR70: 後台管理員可以同步查看前台資料
FR71: 後台管理員可以修改前台資料（依照權限）
FR72: 系統可以與現有後台系統整合資料
FR73: 系統可以自動驗證與現有系統的資料同步結果，偵測並回報資料不一致
FR74: 系統可以記錄所有狀態變更操作
FR75: 系統可以追溯所有操作的歷史記錄
FR76: 系統可以驗證資料完整性
FR77: 於[網頁忘記密碼]下方新增[碼頭-忘記密碼]設定區塊
FR77.1: 碼頭-忘記密碼編輯頁欄位：內文*（文字段落）
FR77.2: 內文內容串接碼頭前台登入頁忘記密碼燈箱顯示
FR78: 通知列表新增頁發送類型新增兩種：全部碼頭人員、特定碼頭人員
FR78.1: 選擇「特定碼頭人員」時顯示[選擇碼頭人員]按鈕
FR78.2: 點擊[選擇碼頭人員]跳出燈箱，搜尋：關鍵字（碼頭人員帳號/人員姓名/所屬廠區）
FR78.3: 燈箱列表抓【碼頭管理>碼頭人員列表】所有啟用中的人員資訊
FR78.4: 燈箱可多選發送對象
FR78.5: 只有[訊息類型]選擇「站內信」時，才可選擇碼頭人員
FR79: 內部廠區新增/編輯頁新增[入庫分貨配送點]按鈕
FR79.1: 點擊[入庫分貨配送點]開啟燈箱
FR79.2: 燈箱搜尋欄位：關鍵字搜尋（配送點代號、配送點簡稱、地址）、客戶簡稱、區域、班別
FR79.3: 燈箱列表顯示【配送點管理>配送點列表】所有配送點資料
FR79.4: 燈箱列表欄位：勾選欄位、配送點代號、配送點簡稱、客戶簡稱、區域、班別、收/送貨地址
FR79.5: 可勾選多筆配送點與內部廠區建立關聯
FR79.6: 可取消勾選多筆配送點與內部廠區解除關聯
FR79.7: 點擊[儲存]時顯示所選入庫分貨配送點
FR80: 配送單管理搜尋欄位新增：作業類型（下拉選單/配送作業/退貨作業）
FR80.1: 列表新增欄位顯示[作業類型]，固定為：配送作業/退貨作業
FR80.2: 現有資料皆帶入為配送作業
FR80.3: 判斷作業類型為「退貨作業」時，不顯示[複製]按鈕及[編輯]按鈕
FR81: 新增頁新增欄位：作業類型*（單選/配送作業、退貨作業）
FR81.1: 作業類型預設選擇為「配送作業」
FR81.2: 選擇「配送作業」同目前操作流程
FR81.3: 選擇「退貨作業」顯示退貨作業專用欄位
FR82: 退貨作業新增頁欄位（作業類型、客戶簡稱、配送溫層、選擇退貨單、配送起迄點等）
FR82.1: 客戶簡稱有編輯時清除配送溫層選擇的項目
FR82.2: 可新增多個配送迄點
FR82.3: 退貨作業沒有[暫存]按鈕功能
FR82.4: 從退貨單帶入的商品不可修改，自行新增的商品才可以
FR82.5: 起點收貨商品/迄點送貨商品表格欄位：送/收、商品名稱、入數、件數、單板件數、板位
FR83: 選擇退貨單燈箱搜尋欄位：關鍵字搜尋（退貨單號）、建立日期、退貨廠區
FR83.1: 燈箱列表依所選客戶簡稱及溫層，顯示狀態為「待立單」的彙整單資料
FR83.2: 燈箱列表欄位：勾選欄位、退貨單號、建立日期、客戶簡稱、溫層、退貨廠區、商品資訊
FR83.3: 可勾選多筆退貨彙整單建立退貨配送單資訊
FR83.4: 商品資訊欄位點擊跳燈箱顯示該筆退貨單商品資訊
FR83.5: 點擊[儲存]時配送單帶入所選退貨單的商品資訊、退貨單備註、檔案上傳
FR84: 送出時判斷同一組起點中，同商品的起點、迄點總和是否相符
FR84.1: 將下單日期顯示為送出時的日期
FR84.2: 將彙整單狀態更新為已立單（後台+前台）
FR84.3: 將配送單號回寫到【後台>退貨單列表】的退貨配送單號
FR85: 配送單查看頁新增顯示欄位：作業類型（配送作業or退貨作業）

### NonFunctional Requirements

NFR1: API 響應時間：95% 請求 < 300ms
NFR2: 頁面載入時間：< 2 秒
NFR3: 互動操作響應時間：< 500ms
NFR4: 篩選與搜尋響應：< 500ms
NFR5: 後台操作反映時間：< 3 秒
NFR6: 狀態變更同步準確率：100%
NFR7: 即時連線穩定性：連線中斷率 < 0.1%
NFR8: 多裝置同步延遲：< 3 秒
NFR9: 碼頭儀錶板狀態更新：延遲 < 3 秒
NFR10: 車輛任務狀態變更反映：顏色更新即時反映（< 1 秒）
NFR11: 未排車次列表篩選：響應時間 < 500ms
NFR12: 收貨列表排序與篩選：響應時間 < 1 秒
NFR13: 簽名板操作：完成時間 < 10 秒
NFR14: 登入驗證：整合後台帳號密碼驗證系統
NFR15: 會話管理：安全登出功能，會話逾時自動登出
NFR16: 權限控制：整合現有權限系統，保持一致性
NFR17: 操作權限驗證：所有操作都進行權限驗證
NFR18: 廠區資料隔離：登入後只顯示符合該人員內部廠區的資料
NFR19: 資料存取控制：依照人員權限限制操作範圍
NFR20: 資料傳輸安全：所有資料傳輸使用加密
NFR21: 敏感資料保護：簽名資料、操作記錄等敏感資訊需加密儲存
NFR22: 操作記錄：記錄所有狀態變更操作
NFR23: 審計日誌：可追溯所有操作的歷史記錄
NFR24: 定期審查：定期審查人員權限設定
NFR25: 系統可用性：> 99.9%（每月停機時間 < 43.2 分鐘）
NFR26: 錯誤率：< 0.1%
NFR27: 系統穩定性：支援多裝置同時監控，具備斷線提示與容錯
NFR28: 與現有系統資料同步準確率：100%
NFR29: 資料遺失率：0%
NFR30: 資料完整性：100%
NFR31: 收貨明細資料儲存：成功率 > 99.9%
NFR32: 網路中斷處理：網路中斷時提示使用者，並在恢復後自動重新連線
NFR33: 即時連線恢復：連線中斷時自動重連，確保資料不遺失
NFR34: 異常處理：提供異常處理流程與異常恢復機制
NFR35: 降級方案：即時通訊失敗時提供降級方案（如輪詢）
NFR36: 後台系統整合：與現有後台系統完整整合資料
NFR37: 資料同步機制：確保即時性與可靠性
NFR38: API 整合：RESTful API 設計，支援標準 HTTP 方法
NFR39: 訊息佇列整合：如需要，支援訊息佇列整合
NFR40: 運務 APP 整合：接收運務 APP 回報的狀態（如回廠下貨）
NFR41: 推播通知整合：發送推播通知到運務 APP
NFR42: 資料格式相容：確保與現有系統的資料格式相容
NFR43: 整合穩定性：整合服務可用性 > 99.5%
NFR44: 資料一致性：確保所有整合系統的資料同步一致
NFR45: 錯誤處理：整合失敗時提供錯誤提示與重試機制

### Additional Requirements

**來自 Architecture 的技術需求：**
- Brownfield 專案：擴展現有 Laravel 7.24 系統（148_changching 專案）
- 現有系統架構：Laravel MVC 架構，包含現有的 Controllers、Models、Services、Routes
- 資料庫：MySQL（現有系統使用）
- 快取：Redis（現有系統使用）
- 前端整合：需整合到現有前端架構（frontend_webapp 目錄）
- API 整合：需遵循現有 API 設計模式（TransportApi 等現有 API 結構）
- 權限系統整合：需整合現有權限系統（HasRoles、HasPermissions traits）
- 通知系統整合：需整合現有通知系統（NoticeService、PushServiceProvider）
- 資料模型整合：需與現有 Models 整合（DeliveryOrder、DeliveryTask、Vehicle 等）
- 路由整合：需遵循現有路由結構（routes/modules/ 目錄結構）

**後台既有功能擴增修改：**
- 既有主功能「網站管理」> 次功能「區塊內容管理」，新增「碼頭-忘記密碼」功能，串聯前台忘記密碼顯示設定的提示文字
- 既有主功能「配送點管理」> 次功能「內部廠區」，內部廠區編輯頁新增「入庫分貨配送點燈箱」，可選擇與所選內部廠區關聯的入庫分貨配送點
- 收貨作業內自動判斷配送單迄點是否與登入人員的內部廠區關聯為入庫分貨：若是 → 收貨明細類型為入庫分貨；若否 → 收貨明細類型為越庫作業

**來自 UX Design 的額外需求：**
- 響應式設計：平板優先（768px - 1024px），支援桌面（> 1024px）和手機（< 768px）
- 設計系統：Element Plus（Vue.js 3）
- 前端框架：Vue.js 3（已選擇）
- 觸控友善：所有互動元素至少 44x44px
- 無障礙性：WCAG AA 等級（顏色對比 4.5:1、鍵盤導航、ARIA 標籤）
- 狀態顏色：綠色（#8eba34 - 正常）、藍色（#3a9cd8 - 缺貨待料）、紅色（#f68480 - 通知未到）
- 固定頂部功能列：一橫排顯示（登出、即時公告、出貨作業、收貨作業、退貨作業）
- 碼頭儀錶板：一橫排顯示，純實色背景顯示狀態，不論車輛狀態皆顯示車牌與喇叭 icon
- 車次詳細配送單燈箱：遮罩不覆蓋整個頁面，按鈕在燈箱內最下方，基本資訊區塊（上班時間/司機姓名/車號車次/路線別），配送資訊可收合展開
- 簽名板：觸控繪製，至少 300x150px
- 即時同步視覺回饋：狀態變更動畫（< 1 秒），同步提示
- 離線功能：網路中斷時可暫存操作，恢復後自動同步

### FR Coverage Map

FR1: Epic 2 - 倉儲人員登入系統
FR2: Epic 2 - 登入憑證驗證與錯誤提示
FR3: Epic 2 - 忘記密碼資訊查看
FR4: Epic 2 - 安全登出系統
FR5: Epic 2 - 廠區資料隔離
FR6: Epic 2 - 整合後台碼頭人員列表進行身份驗證
FR7: Epic 3 - 查看公告列表
FR8: Epic 3 - 篩選公告列表
FR9: Epic 3 - 標記公告為已讀
FR10: Epic 3 - 刪除公告
FR11: Epic 3 - 批量標記公告為已讀
FR12: Epic 3 - 批量刪除公告
FR13: Epic 3 - 查看公告詳細內容
FR14: Epic 3 - 顯示公告已讀/未讀狀態
FR15: Epic 4 - 查看碼頭儀錶板即時狀態
FR16: Epic 4 - 所屬廠區相同的碼頭人員使用相同碼頭儀錶板
FR17: Epic 4 - 從未排車次碼頭下拉選單選擇車輛
FR18: Epic 4 - 根據條件篩選可選車輛
FR19: Epic 4 - 選擇車次加入碼頭後車輛任務狀態改為碼頭處理中
FR20: Epic 4 - 查看任務內含的所有配送單資訊
FR21: Epic 4 - 修改車輛狀態
FR22: Epic 4 - 根據車輛狀態變更自動更新顯示
FR23: Epic 4 - 篩選未排車次列表
FR24: Epic 4 - 根據篩選條件動態更新未排車次列表
FR25: Epic 4 - 根據車輛狀態以不同顏色顯示未排車次
FR25.1: Epic 4 - 已排車次通知圖示
FR25.2: Epic 4 - 通知未到時通知運務員及運務部主管
FR26: Epic 5 - 查看收貨列表
FR27: Epic 5 - 篩選收貨列表
FR28: Epic 5 - 追蹤任務的下貨狀態
FR29: Epic 5 - 接收運務回報的「回廠下貨」狀態
FR30: Epic 5 - 顯示回廠下貨任務的車輛回報位置和時間
FR31: Epic 5 - 為回廠下貨的任務選擇下貨碼頭（依賴 Epic 1 的碼頭列表）
FR32: Epic 5 - 自動排除已選定出貨和下貨的碼頭選項
FR33: Epic 5 - 從收貨列表進入任務的配送點總表
FR34: Epic 5 - 依照狀態和回報時間排序收貨列表
FR35: Epic 5 - 查看配送點總表
FR36: Epic 5 - 從配送點總表進入收貨明細
FR37: Epic 5 - 請運務在配送點總表簽名
FR38: Epic 5 - 運務簽名送出後更新任務收貨狀態為下貨完成
FR39: Epic 5 - 防止收貨狀態為下貨完成的任務再次進入配送點總表
FR40: Epic 5 - 查看入庫分貨的收貨明細
FR41: Epic 5 - 查看越庫作業的收貨明細
FR42: Epic 5 - 顯示收貨明細的進入時間並持續動態更新
FR43: Epic 5 - 查看配送單的商品資訊
FR44: Epic 5 - 修改入庫分貨的實收數量
FR45: Epic 5 - 為入庫分貨的商品新增多組實收數量與有效日期
FR46: Epic 5 - 刪除入庫分貨商品的多組實收數量與有效日期資料
FR47: Epic 5 - 為入庫分貨的商品填寫備註
FR48: Epic 5 - 修改越庫作業的實收板位
FR49: Epic 5 - 為越庫作業的商品新增多組配送點、實收板位、配送日期與備註
FR50: Epic 5 - 刪除越庫作業商品的多組資料
FR51: Epic 5 - 為越庫作業的商品填寫備註
FR52-FR54.4: Epic 6 - 退貨單列表與顯示規則
FR55-FR55.6: Epic 6 - 彙整退貨單功能
FR56-FR56.5: Epic 6 - 退貨單編輯頁
FR57: Epic 6 - 退貨單查看頁（已彙整+回廠退，已立單+直退）
FR57.1-FR57.4: Epic 6 - 彙整單編輯頁
FR58: Epic 6 - 彙整單查看頁
FR58.1: Epic 6 - 整合運務APP和後台退貨單資料
FR59: Epic 7 - 即時同步後台操作到前端顯示
FR60: Epic 7 - 即時同步前端操作到後台和其他裝置
FR61: Epic 7 - 維持即時雙向連線確保資料即時同步
FR62: Epic 7 - 網路中斷時提示使用者
FR63: Epic 7 - 支援多裝置同時監控並保持資料同步
FR64: Epic 7 - 發送推播通知到運務 APP
FR65: Epic 7 - 接收運務 APP 回報的狀態
FR66: Epic 1 - 後台管理員管理碼頭列表
FR66.1-FR66.8: Epic 1 - 碼頭列表（搜尋、顯示、新增、編輯、刪除）
FR67: Epic 1 - 後台管理員管理碼頭人員列表
FR67.1-FR67.8: Epic 1 - 碼頭人員列表（搜尋、顯示、新增、編輯、刪除）
FR68: Epic 8 - 後台管理員查看退貨單列表
FR68.1-FR68.3: Epic 8 - 退貨單列表搜尋欄位、顯示欄位、資料來源
FR68.4-FR68.6: Epic 8 - 後台彙整退貨單功能（彙整規則、單號、狀態流轉）
FR68.7: Epic 8 - 退貨單列表操作按鈕規則
FR68.8-FR68.10: Epic 8 - 後台退貨單新增頁（欄位、送出規則）
FR68.11: Epic 8 - 後台退貨單編輯頁
FR68.12: Epic 8 - 後台退貨單查看頁
FR68.13: Epic 8 - 後台彙整單編輯頁
FR68.14: Epic 8 - 後台彙整單查看頁
FR69: Epic 8 - 後台管理員查詢倉儲收貨資訊
FR69.1-FR69.7: Epic 8 - 倉儲收貨資訊查詢列表頁（搜尋、欄位、排序、狀態流轉、異動追蹤）
FR69.8-FR69.13: Epic 8 - 入庫分貨編輯頁（純顯示欄位、表格、新增刪除規則、前台連動）
FR69.14-FR69.19: Epic 8 - 越庫作業編輯頁（純顯示欄位、表格、新增刪除規則、前台連動）
FR70: Epic 8 - 後台管理員同步查看前台資料
FR71: Epic 8 - 後台管理員修改前台資料（依照權限）
FR72: Epic 9 - 與現有後台系統整合資料
FR73: Epic 9 - 自動驗證資料同步結果、偵測並回報資料不一致
FR74: Epic 9 - 記錄所有狀態變更操作
FR75: Epic 9 - 追溯所有操作的歷史記錄
FR76: Epic 9 - 驗證資料完整性
FR77-FR77.2: Epic 10 - 區塊內容管理新增碼頭-忘記密碼功能
FR78-FR78.5: Epic 10 - 通知列表新增碼頭人員發送類型
FR79-FR79.7: Epic 10 - 內部廠區新增入庫分貨配送點燈箱
FR80-FR80.3: Epic 10 - 配送單管理新增作業類型欄位
FR81-FR81.3: Epic 10 - 配送單新增頁新增作業類型選項
FR82-FR82.5: Epic 10 - 退貨作業新增頁欄位
FR83-FR83.5: Epic 10 - 選擇退貨單燈箱功能
FR84-FR84.3: Epic 10 - 退貨作業送出驗證
FR85: Epic 10 - 配送單查看頁顯示作業類型

## Epic List

| Epic | 名稱 | FRs covered | 優先序 |
|------|------|-------------|--------|
| 1 | 後台基礎資料管理（碼頭與人員） | FR66-FR67（含子項） | 最高（前置依賴） |
| 2 | 身份驗證與基礎設定 | FR1-FR6 | 高（依賴 Epic 1） |
| 3 | 即時公告管理 | FR7-FR14 | 中 |
| 4 | 出貨作業管理 | FR15-FR25.2 | 高（核心功能） |
| 5 | 收貨作業管理 | FR26-FR51 | 高（核心功能） |
| 6 | 退貨作業管理 | FR52-FR58.1 | 高（核心功能） |
| 7 | 即時同步與通知基礎設施 | FR59-FR65 | 高（與 4/5/6 並行） |
| 8 | 後台管理功能擴充 | FR68-FR71（含子項） | 中 |
| 9 | 資料整合與審計 | FR72-FR76 | 中（與其他並行） |
| 10 | 後台既有功能擴增 | FR77-FR85（含子項） | 中 |
| 11 | 運務APP功能擴增 | PRD Section 6 | 中 |

> 各 Epic 詳細描述、完整 FRs covered 列表及 Implementation Notes 見下方對應區段。

## Epic 1: 後台基礎資料管理（碼頭與人員）

後台管理員可以管理碼頭列表和碼頭人員列表，建立前台作業所需的基礎資料。此 Epic 必須優先完成，因為登入驗證與登入後的頁面顯示資料都依賴這些基礎資料。

**FRs covered:** FR66, FR67, FR66.1-FR66.8, FR67.1-FR67.8

### Story 1.1: 後台管理員可以查看碼頭列表

As a 後台管理員,
I want 查看所有碼頭列表,
So that 我可以了解系統中所有碼頭的設定狀況。

**Acceptance Criteria:**

**Given** 後台管理員已登入後台系統
**When** 進入「碼頭管理 > 碼頭列表」頁面
**Then** 系統顯示所有碼頭記錄的列表
**And** 列表顯示欄位：所屬廠區、碼頭名稱、啟用狀態（ON/OFF開關）、操作（編輯/刪除）
**And** 搜尋欄位：關鍵字（碼頭名稱）、所屬廠區（下拉選單/抓【配送點管理>內部廠區】所有啟用的內部廠區名稱）
**And** 點擊[新增]按鈕進入新增詳細頁
**And** 點擊[編輯]按鈕進入編輯詳細頁
**And** 判斷在【碼頭前台>出貨作業】與【碼頭前台>入庫作業】未曾安排過車次的碼頭才顯示[刪除]按鈕
**And** 點擊[刪除]按鈕跳出提示文字燈箱「是否確認刪除」，點擊[確定]後刪除
**And** API 響應時間 < 300ms（NFR1）

### Story 1.2: 後台管理員可以新增碼頭

As a 後台管理員,
I want 新增碼頭記錄,
So that 我可以建立新的碼頭供前台作業使用。

**Acceptance Criteria:**

**Given** 後台管理員在碼頭列表頁面點擊[新增]按鈕
**When** 進入碼頭列表新增頁
**Then** 顯示必填欄位：所屬廠區*（下拉選單/抓【配送點管理>內部廠區】所有啟用的內部廠區名稱）、碼頭名稱*（文字框）
**And** 顯示[返回]和[儲存]按鈕
**And** 點擊[儲存]時系統驗證必填欄位完整性
**And** 系統建立新的碼頭記錄並儲存至資料庫
**And** 系統顯示成功訊息並返回碼頭列表
**And** 新建立的碼頭可立即用於前台作業（Epic 4、Epic 5）
**And** 操作記錄被記錄（為 Epic 9 做準備）

### Story 1.3: 後台管理員可以編輯碼頭

As a 後台管理員,
I want 編輯現有碼頭資訊,
So that 我可以更新碼頭的設定資訊。

**Acceptance Criteria:**

**Given** 後台管理員在碼頭列表頁面點擊[編輯]按鈕
**When** 進入碼頭列表編輯頁
**Then** 顯示欄位同新增頁：所屬廠區*（下拉選單）、碼頭名稱*（文字框）
**And** 預設帶入該碼頭現有資料
**And** 顯示[返回]和[儲存]按鈕
**And** 點擊[儲存]時系統驗證資料完整性
**And** 系統更新碼頭記錄並儲存至資料庫
**And** 系統顯示成功訊息並返回碼頭列表
**And** 修改後的碼頭資訊即時反映在前台作業（Epic 4、Epic 5）
**And** 操作記錄被記錄（為 Epic 9 做準備）

### Story 1.4: 後台管理員可以刪除碼頭

As a 後台管理員,
I want 刪除碼頭記錄,
So that 我可以移除不再使用的碼頭。

**Acceptance Criteria:**

**Given** 後台管理員在碼頭列表頁面
**When** 判斷該碼頭在【碼頭前台>出貨作業】與【碼頭前台>入庫作業】未曾安排過車次
**Then** 顯示[刪除]按鈕
**And** 點擊[刪除]按鈕跳出提示文字燈箱「是否確認刪除」
**And** 點擊[確定]後刪除碼頭記錄
**And** 點擊[取消]關閉燈箱不刪除
**And** 如果碼頭已被使用過，則不顯示[刪除]按鈕
**And** 系統顯示成功訊息並更新碼頭列表
**And** 操作記錄被記錄（為 Epic 9 做準備）

### Story 1.5: 後台管理員可以查看碼頭人員列表

As a 後台管理員,
I want 查看所有碼頭人員列表,
So that 我可以了解系統中所有碼頭人員的設定狀況。

**Acceptance Criteria:**

**Given** 後台管理員已登入後台系統
**When** 進入「碼頭管理 > 碼頭人員列表」頁面
**Then** 系統顯示所有碼頭人員記錄的列表
**And** 列表顯示欄位：人員姓名、人員帳號、所屬廠區、啟用狀態（ON/OFF開關）、操作（編輯/刪除）
**And** 搜尋欄位：關鍵字（人員姓名、人員帳號）、所屬廠區（下拉選單/抓【配送點管理>內部廠區】所有啟用的內部廠區名稱）
**And** 點擊[新增]按鈕進入新增詳細頁
**And** 點擊[編輯]按鈕進入編輯詳細頁
**And** 未曾登入過的碼頭人員才顯示[刪除]按鈕
**And** 點擊[刪除]按鈕跳出提示文字燈箱「是否確認刪除」，點擊[確定]後刪除
**And** API 響應時間 < 300ms（NFR1）

### Story 1.6: 後台管理員可以新增碼頭人員

As a 後台管理員,
I want 新增碼頭人員記錄,
So that 我可以建立新的碼頭人員帳號供前台登入使用。

**Acceptance Criteria:**

**Given** 後台管理員在碼頭人員列表頁面點擊[新增]按鈕
**When** 進入碼頭人員列表新增頁
**Then** 顯示必填欄位：
  - 所屬廠區*（下拉選單/抓【配送點管理>內部廠區】所有啟用的內部廠區名稱）
  - 碼頭人員姓名*（文字框）
  - 碼頭人員帳號*（文字框）
  - 碼頭人員密碼*（文字框/輸入時隱碼顯示）
  - 碼頭人員確認密碼*（文字框/輸入時隱碼顯示）
**And** 顯示[返回]和[儲存]按鈕
**And** 點擊[儲存]時系統驗證必填欄位完整性
**And** 系統驗證帳號唯一性（不允許重複帳號）
**And** 系統驗證密碼與確認密碼一致
**And** 系統建立新的碼頭人員記錄並儲存至資料庫
**And** 系統顯示成功訊息並返回碼頭人員列表
**And** 新建立的碼頭人員可立即用於前台登入驗證（Epic 2）
**And** 操作記錄被記錄（為 Epic 9 做準備）

### Story 1.7: 後台管理員可以編輯碼頭人員

As a 後台管理員,
I want 編輯現有碼頭人員資訊,
So that 我可以更新碼頭人員的設定（如修改密碼、變更所屬廠區等）。

**Acceptance Criteria:**

**Given** 後台管理員在碼頭人員列表頁面點擊[編輯]按鈕
**When** 進入碼頭人員列表編輯頁
**Then** 顯示欄位：
  - 所屬廠區*（下拉選單）
  - 碼頭人員姓名*（文字框）
  - 碼頭人員帳號*（文字框）
  - 碼頭人員密碼（文字框/選填，不顯示原密碼）
**And** 預設顯示該碼頭人員資料，除[碼頭人員密碼]欄位不顯示
**And** 顯示[返回]和[儲存]按鈕
**And** 點擊[儲存]時系統驗證資料完整性
**And** 如果修改帳號，系統驗證帳號唯一性
**And** 如果填寫新密碼，更新密碼；否則保持原密碼
**And** 系統更新碼頭人員記錄並儲存至資料庫
**And** 系統顯示成功訊息並返回碼頭人員列表
**And** 修改後的碼頭人員資訊即時反映在前台登入驗證和資料隔離（Epic 2）
**And** 操作記錄被記錄（為 Epic 9 做準備）

### Story 1.8: 後台管理員可以刪除碼頭人員

As a 後台管理員,
I want 刪除碼頭人員記錄,
So that 我可以移除不再使用的碼頭人員帳號。

**Acceptance Criteria:**

**Given** 後台管理員在碼頭人員列表頁面
**When** 判斷該碼頭人員未曾登入過系統
**Then** 顯示[刪除]按鈕
**And** 點擊[刪除]按鈕跳出提示文字燈箱「是否確認刪除」
**And** 點擊[確定]後刪除碼頭人員記錄
**And** 點擊[取消]關閉燈箱不刪除
**And** 如果人員已曾登入過，則不顯示[刪除]按鈕
**And** 系統顯示成功訊息並更新碼頭人員列表
**And** 刪除後該人員無法再登入前台系統（Epic 2）
**And** 操作記錄被記錄（為 Epic 9 做準備）

## Epic 2: 身份驗證與基礎設定

倉儲人員可以安全登入系統，查看基本資訊，系統根據登入人員的內部廠區設定顯示符合該廠區的資料。

**FRs covered:** FR1, FR2, FR3, FR4, FR5, FR6

### Story 2.1: 倉儲人員可以使用帳號密碼登入系統

As a 倉儲人員,
I want 使用後台設定的帳號密碼登入系統,
So that 我可以存取碼頭作業系統進行日常工作。

**Acceptance Criteria:**

**Given** 倉儲人員在登入頁面
**When** 輸入有效的帳號和密碼（帳號存在於後台碼頭人員列表中）
**Then** 系統整合後台碼頭人員列表進行身份驗證（FR6）
**And** 系統驗證登入憑證成功
**And** 系統建立會話並導向系統主頁面
**And** 系統根據登入人員的內部廠區設定，只顯示符合該廠區的資料（FR5）
**And** 頁面載入時間 < 2 秒（NFR2）
**And** 登入操作響應時間 < 500ms（NFR3）

### Story 2.2: 系統可以驗證登入憑證並顯示錯誤提示

As a 倉儲人員,
I want 系統在登入失敗時顯示明確的錯誤提示,
So that 我可以知道登入失敗的原因並修正。

**Acceptance Criteria:**

**Given** 倉儲人員在登入頁面
**When** 輸入無效的帳號或密碼（帳號不存在、密碼錯誤、帳號已停用等）
**Then** 系統驗證登入憑證失敗（FR2）
**And** 系統顯示明確的錯誤提示訊息（不洩露帳號是否存在等敏感資訊）
**And** 系統不建立會話，停留在登入頁面
**And** 錯誤提示響應時間 < 500ms（NFR3）
**And** 系統整合後台碼頭人員列表進行驗證（FR6）

### Story 2.3: 倉儲人員可以查看忘記密碼的相關資訊

As a 倉儲人員,
I want 查看忘記密碼的相關資訊,
So that 我可以知道如何處理忘記密碼的情況。

**Acceptance Criteria:**

**Given** 倉儲人員在登入頁面
**When** 點擊「忘記密碼」連結
**Then** 系統顯示忘記密碼頁面
**And** 系統從後台「網站管理 > 區塊內容管理 > 碼頭-忘記密碼」取得提示文字並顯示（FR3）
**And** 提示文字包含如何聯繫管理員或重置密碼的資訊
**And** 頁面載入時間 < 2 秒（NFR2）

### Story 2.4: 倉儲人員可以安全登出系統

As a 倉儲人員,
I want 安全登出系統,
So that 我可以確保會話結束，保護帳號安全。

**Acceptance Criteria:**

**Given** 倉儲人員已登入系統
**When** 點擊「登出」按鈕（位於固定頂部功能列）
**Then** 系統終止當前會話（FR4）
**And** 系統清除會話資料
**And** 系統導向登入頁面
**And** 登出後無法再存取需要登入的頁面
**And** 會話逾時時系統自動登出（NFR15）

### Story 2.5: 系統可以根據登入人員的內部廠區設定顯示符合該廠區的資料

As a 倉儲人員,
I want 系統只顯示符合我內部廠區設定的資料,
So that 我不會看到其他廠區的資料，確保資料隔離。

**Acceptance Criteria:**

**Given** 倉儲人員已成功登入系統
**When** 系統載入任何資料（出貨作業、收貨作業、退貨作業等）
**Then** 系統根據登入人員的內部廠區設定，只顯示符合該廠區的資料（FR5）
**And** 所有資料查詢都自動套用廠區資料隔離篩選條件
**And** 系統不顯示其他廠區的資料
**And** 資料隔離在後端 API 層級實作，確保安全性（NFR18）
**And** 資料存取控制依照人員權限限制操作範圍（NFR19）

### Story 2.6: 系統可以整合後台碼頭人員列表進行身份驗證

As a 系統,
I want 整合後台碼頭人員列表進行身份驗證,
So that 登入驗證使用統一的資料來源，確保一致性。

**Acceptance Criteria:**

**Given** 系統需要驗證倉儲人員的登入憑證
**When** 倉儲人員嘗試登入
**Then** 系統查詢後台碼頭人員列表（Epic 1 建立的資料）
**And** 系統驗證帳號是否存在於碼頭人員列表中（FR6）
**And** 系統驗證密碼是否正確
**And** 系統驗證帳號狀態（是否啟用）
**And** 驗證過程整合現有後台系統架構
**And** 驗證響應時間 < 500ms（NFR3）

## Epic 3: 即時公告管理

倉儲人員可以查看與管理公告，包括篩選、標記已讀、刪除等操作。

**FRs covered:** FR7, FR8, FR9, FR10, FR11, FR12, FR13, FR14

### Story 3.1: 倉儲人員可以查看公告列表

As a 倉儲人員,
I want 查看公告列表,
So that 我可以了解最新的公告資訊。

**Acceptance Criteria:**

**Given** 倉儲人員已登入系統
**When** 點擊固定頂部功能列的「即時公告」按鈕
**Then** 系統顯示公告列表頁面（FR7）
**And** 列表顯示所有公告的基本資訊（標題、日期、時間、已讀/未讀狀態等）
**And** 系統顯示公告的已讀/未讀狀態（FR14）
**And** 頁面載入時間 < 2 秒（NFR2）
**And** 系統沿用現有公告系統架構

### Story 3.2: 倉儲人員可以篩選公告列表

As a 倉儲人員,
I want 篩選公告列表,
So that 我可以快速找到特定條件的公告。

**Acceptance Criteria:**

**Given** 倉儲人員在公告列表頁面
**When** 使用篩選功能（如依日期範圍、已讀/未讀狀態等篩選）
**Then** 系統根據篩選條件動態更新公告列表（FR8）
**And** 篩選響應時間 < 500ms（NFR4）
**And** 篩選條件可組合使用

### Story 3.3: 倉儲人員可以查看公告詳細內容

As a 倉儲人員,
I want 查看公告詳細內容,
So that 我可以了解公告的完整資訊。

**Acceptance Criteria:**

**Given** 倉儲人員在公告列表頁面
**When** 點擊某個公告項目
**Then** 系統顯示公告詳細內容頁面（FR13）
**And** 詳細內容包含日期、時間、標題、內容等完整資訊
**And** 頁面載入時間 < 2 秒（NFR2）

### Story 3.4: 倉儲人員可以標記單一公告為已讀

As a 倉儲人員,
I want 標記單一公告為已讀,
So that 我可以追蹤已閱讀的公告。

**Acceptance Criteria:**

**Given** 倉儲人員在公告列表頁面或公告詳細頁面
**When** 點擊「標記為已讀」按鈕（針對單一公告）
**Then** 系統將該公告標記為已讀（FR9）
**And** 系統更新公告的已讀/未讀狀態顯示（FR14）
**And** 操作響應時間 < 500ms（NFR3）
**And** 已讀狀態即時反映在列表和詳細頁面

### Story 3.5: 倉儲人員可以批量標記公告為已讀

As a 倉儲人員,
I want 批量標記公告為已讀（依照篩選條件）,
So that 我可以一次標記多個符合條件的公告為已讀，提高效率。

**Acceptance Criteria:**

**Given** 倉儲人員在公告列表頁面
**When** 設定篩選條件並點擊「批量標記為已讀」按鈕
**Then** 系統將所有符合篩選條件的公告標記為已讀（FR11）
**And** 系統更新所有相關公告的已讀/未讀狀態顯示（FR14）
**And** 系統顯示成功訊息（如「已標記 X 筆公告為已讀」）
**And** 操作響應時間 < 500ms（NFR3）
**And** 批量操作支援依照篩選條件執行

### Story 3.6: 倉儲人員可以刪除單一公告

As a 倉儲人員,
I want 刪除單一公告,
So that 我可以移除不需要的公告。

**Acceptance Criteria:**

**Given** 倉儲人員在公告列表頁面或公告詳細頁面
**When** 點擊「刪除」按鈕（針對單一公告）
**Then** 系統顯示確認對話框
**And** 確認後系統刪除該公告（FR10）
**And** 系統更新公告列表，移除已刪除的公告
**And** 操作響應時間 < 500ms（NFR3）

### Story 3.7: 倉儲人員可以批量刪除公告

As a 倉儲人員,
I want 批量刪除公告（依照篩選條件）,
So that 我可以一次刪除多個符合條件的公告，提高效率。

**Acceptance Criteria:**

**Given** 倉儲人員在公告列表頁面
**When** 設定篩選條件並點擊「批量刪除」按鈕
**Then** 系統顯示確認對話框，顯示將刪除的公告數量
**And** 確認後系統刪除所有符合篩選條件的公告（FR12）
**And** 系統更新公告列表，移除已刪除的公告
**And** 系統顯示成功訊息（如「已刪除 X 筆公告」）
**And** 操作響應時間 < 500ms（NFR3）
**And** 批量操作支援依照篩選條件執行

## Epic 4: 出貨作業管理

倉儲人員可以管理碼頭出貨作業，包括查看碼頭儀錶板、選擇車次、發送通知、修改車輛狀態等完整出貨流程。

**FRs covered:** FR15, FR16, FR17, FR18, FR19, FR20, FR21, FR22, FR23, FR24, FR25, FR25.1, FR25.2

### Story 4.1: 倉儲人員可以查看碼頭儀錶板即時狀態

As a 倉儲人員,
I want 查看碼頭儀錶板顯示所屬廠區啟用中碼頭的即時狀態,
So that 我可以一眼了解碼頭的當前狀況。

**Acceptance Criteria:**

**Given** 倉儲人員已登入系統並進入出貨作業頁面
**When** 系統載入出貨作業頁面
**Then** 系統顯示碼頭儀錶板，一橫排顯示所屬廠區啟用中的碼頭（FR15）
**And** 碼頭來源為【碼頭管理 > 碼頭列表】，碼頭底色固定綠色（FR15）
**And** 所屬廠區相同的碼頭人員使用相同碼頭儀錶板（FR16）
**And** 碼頭儀錶板狀態更新延遲 < 3 秒（NFR9）
**And** 頁面載入時間 < 2 秒（NFR2）

### Story 4.2: 倉儲人員可以從未排車次的碼頭下拉選單選擇車次

As a 倉儲人員,
I want 從未排車次的碼頭下拉選單中選擇車次,
So that 我可以為碼頭分配適當的車次進行出貨作業。

**Acceptance Criteria:**

**Given** 倉儲人員在出貨作業頁面，某個碼頭未排車次
**When** 點擊該碼頭的下拉選單
**Then** 系統顯示可選車次，格式為 [車牌]([車次])(任務單號)，車次抓【配送點管理 > 固定路線】該路線別所設之車次代號（FR17）
**And** 系統根據條件篩選可選車次（FR18）：當天配送日期、任務起點為同廠區、該任務有任何一筆送貨，符合時任務狀態為「待出貨」
**And** 選擇車次加入碼頭後，系統將該車輛任務狀態改為「碼頭處理中」（FR19）
**And** 下拉選單響應時間 < 500ms（NFR4）
**And** 選擇車次後，碼頭顯示車牌（車次）與喇叭 icon，底色固定綠色

### Story 4.3: 倉儲人員可以透過已排車次通知圖示發送通知給運務

As a 倉儲人員,
I want 在已排車次的碼頭名稱旁點擊通知圖示發送通知給該車次配送任務的運務員,
So that 我可以通知運務前往碼頭進行出貨作業。

**Acceptance Criteria:**

**Given** 倉儲人員在出貨作業頁面，某個碼頭已選定車次
**When** 已排車次的碼頭名稱旁顯示通知圖示（喇叭 icon），倉儲人員點擊該圖示（FR25.1）
**Then** 系統發送自動通知給該車次配送任務的運務員
**And** 系統顯示提示文字「已通知司機前往碼頭」
**And** 系統整合現有通知系統（NoticeService、PushServiceProvider）
**And** 通知發送響應時間 < 500ms（NFR3）
**And** 通知可透過推播通知整合發送到運務 APP（為 Epic 7 做準備）

### Story 4.4: 倉儲人員可以查看車次詳細資訊燈箱

As a 倉儲人員,
I want 點擊已排車次開啟車次詳細資訊燈箱,
So that 我可以了解該車次的完整配送任務與收送貨商品、載具資訊。

**Acceptance Criteria:**

**Given** 倉儲人員在出貨作業頁面，某個碼頭已選定車次
**When** 點擊該碼頭（非喇叭 icon）
**Then** 系統跳出車次詳細資訊燈箱（FR20）
**And** 燈箱顯示配送任務資料：上班時間、司機姓名、車號車次、路線別
**And** 燈箱顯示所有配送點的收送貨商品與載具詳細資訊
**And** 燈箱遮罩不覆蓋整個頁面，僅在燈箱區域顯示遮罩
**And** 燈箱顯示配送資訊，所有配送點資料預設收合、點擊時展開；單一配送點可能有多位客戶的配送單，各配送單亦預設收合、點擊時展開顯示：客戶簡稱、配送單號、聯絡人、電話、配送商品資訊、配送載具資訊、收貨備註（配送起點）、送貨備註（配送迄點）
**And** 頁面載入時間 < 2 秒（NFR2）

### Story 4.5: 倉儲人員可以修改車輛狀態為完成出車或取消

As a 倉儲人員,
I want 在車次詳細配送單燈箱中修改車輛狀態為完成出車或取消,
So that 我可以記錄車輛已完成出車或取消出貨，任務狀態改為配送中。

**Acceptance Criteria:**

**Given** 倉儲人員在車次詳細配送單燈箱中
**When** 點擊燈箱內最下方的「完成出車」或「取消」按鈕
**Then** 系統更新配送任務狀態：完成出車（→ 配送中）、取消（→ 配送中）（FR21）
**And** 如果選擇「完成出車」，系統顯示提示文字「已完成出車」
**And** 系統根據車輛任務狀態變更自動更新顯示（FR22）：配送中的車輛從碼頭儀錶板與未排車次列表移除
**And** 狀態變更顏色更新即時反映（< 1 秒）（NFR10）
**And** 操作記錄被記錄（為 Epic 9 做準備）

### Story 4.6: 倉儲人員可以修改車輛狀態為缺貨待料

As a 倉儲人員,
I want 在車次詳細配送單燈箱中修改車輛狀態為缺貨待料,
So that 我可以記錄車輛因缺貨待料而無法出貨。

**Acceptance Criteria:**

**Given** 倉儲人員在車次詳細配送單燈箱中
**When** 點擊燈箱內最下方的「缺貨待料」按鈕
**Then** 系統更新車輛狀態為缺貨待料（FR21）
**And** 系統根據車輛任務狀態變更自動更新顯示（FR22）：缺貨待料的車輛從碼頭移除但回到未排車次列表
**And** 系統關閉詳細資訊燈箱，回到出貨作業頁面
**And** 狀態變更顏色更新即時反映（< 1 秒）（NFR10）
**And** 操作記錄被記錄（為 Epic 9 做準備）

### Story 4.7: 倉儲人員可以修改車輛狀態為通知未到

As a 倉儲人員,
I want 在車次詳細配送單燈箱中修改車輛狀態為通知未到,
So that 我可以記錄車輛因通知未到而無法出貨。

**Acceptance Criteria:**

**Given** 倉儲人員在車次詳細配送單燈箱中
**When** 點擊燈箱內最下方的「通知未到」按鈕
**Then** 系統更新車輛狀態為通知未到（FR21）
**And** 系統根據車輛任務狀態變更自動更新顯示（FR22）：通知未到的車輛從碼頭移除但回到未排車次列表
**And** 系統同時發送自動通知給該車次配送任務的運務員及運務部主管（FR25.2）
**And** 系統關閉詳細資訊燈箱，回到出貨作業頁面
**And** 狀態變更顏色更新即時反映（< 1 秒）（NFR10）
**And** 操作記錄被記錄（為 Epic 9 做準備）

### Story 4.8: 倉儲人員可以查看未排車次列表

As a 倉儲人員,
I want 查看未排車次列表,
So that 我可以了解尚未分配到碼頭的車次狀況。

**Acceptance Criteria:**

**Given** 倉儲人員在出貨作業頁面
**When** 系統載入未排車次列表
**Then** 系統顯示未排車次列表，不顯示任務狀態為碼頭處理中、配送中、配送異常、配送完成的車輛（FR24）
**And** 系統根據車輛任務狀態以不同顏色顯示未排車次（FR25）：
  - 綠色（#8eba34）：待出貨
  - 藍色（#3a9cd8）：缺貨待料
  - 紅色（#f68480）：通知未到
**And** 列表只顯示符合登入人員內部廠區的車輛（依賴 Epic 2）
**And** 頁面載入時間 < 2 秒（NFR2）

### Story 4.9: 倉儲人員可以透過出貨日期和班別篩選未排車次列表

As a 倉儲人員,
I want 透過出貨日期和班別篩選未排車次列表,
So that 我可以快速找到特定條件的未排車次。

**Acceptance Criteria:**

**Given** 倉儲人員在出貨作業頁面
**When** 使用出貨日期和班別設定篩選條件（針對未排車次列表）（FR23）
**Then** 系統根據篩選條件動態更新未排車次列表
**And** 篩選響應時間 < 500ms（NFR11）
**And** 篩選後的列表仍保持顏色狀態顯示（FR25）

### Story 4.10: 系統可以即時更新碼頭儀錶板和未排車次列表的狀態

As a 倉儲人員,
I want 系統即時更新碼頭儀錶板和未排車次列表的狀態,
So that 我可以看到最新的車輛狀態變化。

**Acceptance Criteria:**

**Given** 倉儲人員在出貨作業頁面
**When** 車輛任務狀態發生變更（完成出車、取消、缺貨待料、通知未到）
**Then** 系統根據車輛任務狀態變更自動更新顯示（FR22）：配送中的車輛從碼頭儀錶板與未排車次列表移除；缺貨待料／通知未到的車輛從碼頭移除但回到未排車次列表
**And** 碼頭儀錶板狀態更新延遲 < 3 秒（NFR9）
**And** 車輛任務狀態變更反映顏色更新即時反映（< 1 秒）（NFR10）
**And** 狀態變更透過即時同步機制更新（為 Epic 7 做準備）
**And** 多裝置同步延遲 < 3 秒（NFR8）

## Epic 5: 收貨作業管理

倉儲人員可以管理收貨作業，包括查看收貨列表、進入配送點總表、查看收貨明細、請運務簽名等完整收貨流程。

**FRs covered:** FR26, FR27, FR28, FR29, FR30, FR31, FR32, FR33, FR34, FR35, FR36, FR37, FR38, FR39, FR40, FR41, FR42, FR43, FR44, FR45, FR46, FR47, FR48, FR49, FR50, FR51

### Story 5.1: 倉儲人員可以查看收貨列表

As a 倉儲人員,
I want 查看收貨列表顯示所有包含收貨的任務,
So that 我可以了解所有需要處理的收貨任務。

**Acceptance Criteria:**

**Given** 倉儲人員已登入系統並點擊固定頂部功能列的「收貨作業」
**When** 系統載入收貨列表頁面
**Then** 系統顯示所有包含收貨的任務列表（FR26）
**And** 列表顯示任務的關鍵資訊（車號、狀態、回報時間等）
**And** 列表只顯示符合登入人員內部廠區的任務（依賴 Epic 2）
**And** 頁面載入時間 < 2 秒（NFR2）

### Story 5.2: 系統可以追蹤任務的下貨狀態

As a 倉儲人員,
I want 系統追蹤任務的下貨狀態,
So that 我可以了解任務的當前進度。

**Acceptance Criteria:**

**Given** 倉儲人員在收貨列表頁面
**When** 系統載入任務列表
**Then** 系統追蹤任務的下貨狀態（FR28）：
  - 接貨中：運務正在接貨
  - 回廠下貨：運務已回報回廠下貨
  - 下貨完成：運務已於配送點總表簽名送出
**And** 系統顯示任務的當前狀態
**And** 狀態即時更新（為 Epic 7 做準備）

### Story 5.3: 系統可以接收運務回報的「回廠下貨」狀態並更新任務狀態

As a 系統,
I want 接收運務 APP 回報的「回廠下貨」狀態,
So that 我可以即時更新任務狀態，讓倉儲人員知道運務已回廠。

**Acceptance Criteria:**

**Given** 運務透過運務 APP 回報「回廠下貨」狀態
**When** 系統接收運務 APP 回報的狀態
**Then** 系統更新任務狀態為「回廠下貨」（FR29）
**And** 系統顯示回廠下貨任務的車輛回報位置和時間（FR30）
**And** 狀態更新即時反映在收貨列表中（< 3 秒）（NFR5）
**And** 系統整合運務 APP 整合（為 Epic 7 做準備）

### Story 5.4: 倉儲人員可以為回廠下貨的任務選擇下貨碼頭

As a 倉儲人員,
I want 為回廠下貨的任務選擇下貨碼頭,
So that 我可以指定運務應該在哪個碼頭下貨。

**Acceptance Criteria:**

**Given** 倉儲人員在收貨列表頁面，某個任務狀態為「回廠下貨」
**When** 點擊該任務的下貨碼頭選擇功能
**Then** 系統顯示可選的下貨碼頭列表（FR31，依賴 Epic 1 的碼頭列表）
**And** 系統自動排除已選定出貨和下貨的碼頭選項（FR32）
**And** 選擇下貨碼頭後，系統更新任務的下貨碼頭資訊
**And** 系統推播通知到運務 APP 給該司機，通知已選定下貨碼頭
**And** 原運務 APP 回廠下貨按鈕顯示下貨碼頭名稱
**And** 操作響應時間 < 500ms（NFR3）
**And** 通知整合推播通知系統（為 Epic 7 做準備）

### Story 5.5: 系統可以依照狀態和回報時間排序收貨列表

As a 倉儲人員,
I want 收貨列表依照狀態和回報時間排序,
So that 我可以優先處理需要立即處理的任務。

**Acceptance Criteria:**

**Given** 倉儲人員在收貨列表頁面
**When** 系統載入或更新收貨列表
**Then** 系統依照狀態和回報時間排序收貨列表（FR34）：
  - 先顯示「回廠下貨」狀態的任務
  - 再顯示「接貨中」狀態的任務
  - 再顯示「下貨完成」狀態的任務
  - 同樣狀態依回報時間新到舊排序
**And** 排序響應時間 < 1 秒（NFR12）

### Story 5.6: 倉儲人員可以篩選收貨列表

As a 倉儲人員,
I want 篩選收貨列表,
So that 我可以快速找到特定條件的收貨任務。

**Acceptance Criteria:**

**Given** 倉儲人員在收貨列表頁面
**When** 使用篩選功能設定篩選條件
**Then** 系統根據篩選條件動態更新收貨列表（FR27）
**And** 篩選響應時間 < 1 秒（NFR12）
**And** 篩選條件可組合使用

### Story 5.7: 倉儲人員可以從收貨列表進入任務的配送點總表

As a 倉儲人員,
I want 從收貨列表進入任務的配送點總表,
So that 我可以查看該任務的所有配送點資訊。

**Acceptance Criteria:**

**Given** 倉儲人員在收貨列表頁面，某個任務收貨狀態未為「下貨完成」
**When** 點擊列表欄位的「車號」（顯示為可點擊按鈕）
**Then** 系統進入該任務的配送點總表（FR33）
**And** 如果任務收貨狀態為「下貨完成」，車號顯示為純文字（非按鈕），無法點擊（FR39）
**And** 頁面載入時間 < 2 秒（NFR2）

### Story 5.8: 倉儲人員可以查看配送點總表

As a 倉儲人員,
I want 查看配送點總表顯示任務所有有收貨的配送單資訊,
So that 我可以了解該任務的所有配送點狀況。

**Acceptance Criteria:**

**Given** 倉儲人員在配送點總表頁面
**When** 系統載入配送點總表
**Then** 系統顯示任務所有有收貨的配送單資訊（FR35）
**And** 配送點總表依配送單客戶和配送點做分類，一個客戶+配送點顯示為一列
**And** 相同配送點排序在一起
**And** 列表顯示配送點的關鍵資訊（配送點、客戶、收貨類型、狀態等）
**And** 不同狀態以小方框不同顏色顯示（使用狀態顏色系統）
**And** 收貨類型顯示為「入庫分貨」或「越庫作業」（自動判斷，依賴後台內部廠區設定的入庫分貨配送點）
**And** 頁面載入時間 < 2 秒（NFR2）

### Story 5.9: 倉儲人員可以從配送點總表進入收貨明細

As a 倉儲人員,
I want 從配送點總表進入收貨明細,
So that 我可以查看並修改該配送點的詳細收貨資訊。

**Acceptance Criteria:**

**Given** 倉儲人員在配送點總表頁面
**When** 點擊列表欄位的「配送點」
**Then** 系統進入收貨明細頁面（FR36）
**And** 系統自動判斷收貨明細類型（入庫分貨/越庫作業）：
  - 如果配送單迄點與登入人員的內部廠區關聯為入庫分貨 → 收貨明細類型為入庫分貨
  - 否則 → 收貨明細類型為越庫作業
**And** 頁面載入時間 < 2 秒（NFR2）

### Story 5.10: 倉儲人員可以查看入庫分貨的收貨明細

As a 倉儲人員,
I want 查看入庫分貨的收貨明細,
So that 我可以核對並修改入庫分貨的商品資訊。

**Acceptance Criteria:**

**Given** 倉儲人員在收貨明細頁面，收貨明細類型為「入庫分貨」
**When** 系統載入收貨明細
**Then** 系統顯示入庫分貨的收貨明細（FR40）
**And** 系統顯示收貨明細的進入時間並持續動態更新（FR42）
**And** 系統顯示配送單的商品資訊（FR43）：客戶簡稱、商品名稱、單據資訊等
**And** 系統顯示每項商品的實收數量與有效日期（可多組）
**And** 頁面載入時間 < 2 秒（NFR2）

### Story 5.11: 倉儲人員可以查看越庫作業的收貨明細

As a 倉儲人員,
I want 查看越庫作業的收貨明細,
So that 我可以核對並修改越庫作業的商品資訊。

**Acceptance Criteria:**

**Given** 倉儲人員在收貨明細頁面，收貨明細類型為「越庫作業」
**When** 系統載入收貨明細
**Then** 系統顯示越庫作業的收貨明細（FR41）
**And** 系統顯示收貨明細的進入時間並持續動態更新（FR42）
**And** 系統顯示配送單的商品資訊（FR43）：客戶簡稱、商品名稱、單據資訊等
**And** 系統顯示每項商品的配送點、實收板位、配送日期與備註（可多組）
**And** 頁面載入時間 < 2 秒（NFR2）

### Story 5.12: 倉儲人員可以修改入庫分貨的實收數量

As a 倉儲人員,
I want 修改入庫分貨的實收數量,
So that 我可以記錄實際收到的商品數量。

**Acceptance Criteria:**

**Given** 倉儲人員在入庫分貨的收貨明細頁面
**When** 修改某項商品的實收數量
**Then** 系統更新該商品的實收數量（FR44）
**And** 系統驗證實收數量的合理性
**And** 修改即時儲存或提供儲存按鈕
**And** 操作響應時間 < 500ms（NFR3）

### Story 5.13: 倉儲人員可以為入庫分貨的商品新增多組實收數量與有效日期

As a 倉儲人員,
I want 為入庫分貨的商品新增多組實收數量與有效日期,
So that 我可以記錄不同批次的商品資訊。

**Acceptance Criteria:**

**Given** 倉儲人員在入庫分貨的收貨明細頁面
**When** 點擊「新增」按鈕為某項商品新增實收數量與有效日期
**Then** 系統新增一組實收數量與有效日期欄位（FR45）
**And** 系統驗證必填欄位（實收數量、有效日期）
**And** 系統允許為同一商品新增多組資料
**And** 操作響應時間 < 500ms（NFR3）

### Story 5.14: 倉儲人員可以刪除入庫分貨商品的多組實收數量與有效日期資料

As a 倉儲人員,
I want 刪除入庫分貨商品的多組實收數量與有效日期資料,
So that 我可以移除錯誤或不需要的資料。

**Acceptance Criteria:**

**Given** 倉儲人員在入庫分貨的收貨明細頁面，某項商品有多組實收數量與有效日期
**When** 點擊某組資料的「刪除」按鈕
**Then** 系統檢查該商品是否只剩一組資料
**And** 如果只剩一組，系統顯示錯誤提示並阻止刪除（最少必須保留一組）
**And** 如果有多組，系統刪除該組資料（FR46）
**And** 操作響應時間 < 500ms（NFR3）

### Story 5.15: 倉儲人員可以為入庫分貨的商品填寫備註

As a 倉儲人員,
I want 為入庫分貨的商品填寫備註,
So that 我可以記錄特殊情況或注意事項。

**Acceptance Criteria:**

**Given** 倉儲人員在入庫分貨的收貨明細頁面
**When** 為某項商品填寫備註
**Then** 系統儲存備註資訊（FR47）
**And** 備註可即時儲存或提供儲存按鈕
**And** 操作響應時間 < 500ms（NFR3）

### Story 5.16: 倉儲人員可以修改越庫作業的實收板位

As a 倉儲人員,
I want 修改越庫作業的實收板位,
So that 我可以記錄實際收到的板位資訊。

**Acceptance Criteria:**

**Given** 倉儲人員在越庫作業的收貨明細頁面
**When** 修改某項商品的實收板位
**Then** 系統更新該商品的實收板位（FR48）
**And** 系統驗證實收板位的格式或合理性
**And** 修改即時儲存或提供儲存按鈕
**And** 操作響應時間 < 500ms（NFR3）

### Story 5.17: 倉儲人員可以為越庫作業的商品新增多組配送點、實收板位、配送日期與備註

As a 倉儲人員,
I want 為越庫作業的商品新增多組配送點、實收板位、配送日期與備註,
So that 我可以記錄不同配送點的資訊。

**Acceptance Criteria:**

**Given** 倉儲人員在越庫作業的收貨明細頁面
**When** 點擊「新增」按鈕為某項商品新增配送點、實收板位、配送日期與備註
**Then** 系統新增一組配送點、實收板位、配送日期與備註欄位（FR49）
**And** 系統驗證必填欄位（配送點、實收板位、配送日期）
**And** 系統允許為同一商品新增多組資料
**And** 操作響應時間 < 500ms（NFR3）

### Story 5.18: 倉儲人員可以刪除越庫作業商品的多組資料

As a 倉儲人員,
I want 刪除越庫作業商品的多組資料（配送點、實收板位、配送日期與備註）,
So that 我可以移除錯誤或不需要的資料。

**Acceptance Criteria:**

**Given** 倉儲人員在越庫作業的收貨明細頁面，某項商品有多組資料
**When** 點擊某組資料的「刪除」按鈕
**Then** 系統檢查該商品是否只剩一組資料
**And** 如果只剩一組，系統顯示錯誤提示並阻止刪除（最少必須保留一組）
**And** 如果有多組，系統刪除該組資料（FR50）
**And** 操作響應時間 < 500ms（NFR3）

### Story 5.19: 倉儲人員可以為越庫作業的商品填寫備註

As a 倉儲人員,
I want 為越庫作業的商品填寫備註,
So that 我可以記錄特殊情況或注意事項。

**Acceptance Criteria:**

**Given** 倉儲人員在越庫作業的收貨明細頁面
**When** 為某項商品填寫備註
**Then** 系統儲存備註資訊（FR51）
**And** 備註可即時儲存或提供儲存按鈕
**And** 操作響應時間 < 500ms（NFR3）

### Story 5.20: 倉儲人員可以請運務在配送點總表簽名

As a 倉儲人員,
I want 請運務在配送點總表簽名,
So that 我可以確認運務已完成收貨作業。

**Acceptance Criteria:**

**Given** 倉儲人員在配送點總表頁面，已完成所有收貨明細的核對
**When** 點擊「收貨完成」按鈕
**Then** 系統跳出簽名板燈箱（FR37）
**And** 簽名板至少 300x150px，支援觸控繪製
**And** 簽名板顯示「送出」按鈕
**And** 簽名板操作完成時間 < 10 秒（NFR13）

### Story 5.21: 系統可以在運務簽名送出後將任務收貨狀態更新為下貨完成

As a 系統,
I want 在運務簽名送出後將任務收貨狀態更新為下貨完成,
So that 我可以記錄收貨作業已完成。

**Acceptance Criteria:**

**Given** 倉儲人員在簽名板燈箱中，運務已完成簽名
**When** 點擊「送出」按鈕
**Then** 系統驗證簽名資料完整性
**And** 系統將簽名資料回傳後台紀錄
**And** 系統將任務收貨狀態更新為「下貨完成」（FR38）
**And** 系統跳轉回收貨列表
**And** 該任務的車號改為純顯示（非按鈕），不可再次進入配送點總表（FR39）
**And** 收貨明細資料儲存成功率 > 99.9%（NFR31）
**And** 操作記錄被記錄（為 Epic 9 做準備）

## Epic 6: 退貨作業管理

倉儲人員可以查看退貨單列表（運務APP、後台退貨單及彙整單），透過篩選、彙整、編輯、查看等操作管理退貨單與彙整單。

**FRs covered:** FR52, FR53, FR54, FR54.1, FR54.2, FR54.3, FR54.4, FR55, FR55.1-FR55.6, FR56, FR56.1-FR56.5, FR57, FR57.1-FR57.4, FR58, FR58.1

### Story 6.1: 倉儲人員可以查看退貨單列表（顯示欄位、顯示規則、資料來源）

As a 倉儲人員,
I want 查看退貨單列表，顯示運務APP、後台退貨單及彙整單,
So that 我可以了解所有需要處理的退貨單。

**Acceptance Criteria:**

**Given** 倉儲人員已登入系統並點擊固定頂部功能列的「退貨作業」
**When** 系統載入退貨單列表頁面
**Then** 系統顯示退貨單列表，資料來源包含運務APP、後台退貨單及彙整單（FR52）
**And** 系統顯示退貨單的關鍵資訊（FR54）：列表含「勾選格」、退貨單號（格式 yyyymmdd0000N）、建立日期（格式 yyyy/mm/dd）、原配送單號、客戶簡稱、溫層、退貨類型、狀態
**And** 退貨類型為「直退」時，只顯示任務起點內部廠區同登入者所屬廠區的退貨單（FR54.1）
**And** 退貨類型為「回廠退」時，只顯示退貨廠區同登入者所屬廠區的退貨單（FR54.2）
**And** 後台新增的退貨單及彙整單不顯示原配送單號（FR54.3）
**And** 列表依建立日期由新到舊降冪排列（FR54.4）
**And** 系統整合運務 APP 和後台產生的退貨單資料（FR58.1）
**And** 頁面載入時間 < 2 秒（NFR2）

### Story 6.2: 倉儲人員可以透過篩選條件篩選退貨單列表

As a 倉儲人員,
I want 透過關鍵字、建立日期、客戶簡稱、溫層、退貨類型、狀態篩選退貨單列表,
So that 我可以快速找到特定條件的退貨單。

**Acceptance Criteria:**

**Given** 倉儲人員在退貨單列表頁面
**When** 使用篩選功能設定篩選條件（關鍵字、建立日期、客戶簡稱、溫層、退貨類型、狀態）
**Then** 系統根據篩選條件動態更新退貨單列表（FR53）
**And** 篩選響應時間 < 500ms（NFR4）
**And** 篩選條件可組合使用

### Story 6.3: 倉儲人員可以勾選退貨單點擊彙整退貨單合併為彙整單

As a 倉儲人員,
I want 勾選退貨單並點擊彙整退貨單，將多筆合併為一張彙整單,
So that 我可以將同客戶同溫層的未完成退貨單合併處理。

**Acceptance Criteria:**

**Given** 倉儲人員在退貨單列表頁面
**When** 勾選一筆或多筆退貨單，點擊「彙整退貨單」
**Then** 系統驗證被勾選的退貨單狀態必為「未完成」，且須同客戶簡稱與溫層；若不符，跳提示文字「請選擇同客戶溫層的未完成退貨單」（FR55.1）
**And** 單張退貨單也可以直接建立為彙整單（FR55.2）
**And** 彙整單號規則：BA+yyyymmdd+00001（FR55.3）
**And** 彙整單類型顯示為「彙整單」，狀態為「待立單」（FR55.4）
**And** 被合併的原退貨單狀態變為「已彙整」（FR55.5）
**And** 彙整單同步顯示於碼頭前台退貨作業列表頁及後台【碼頭管理 > 退貨單列表】（FR55.6）
**And** 操作響應時間 < 500ms（NFR3）

### Story 6.4: 倉儲人員可以編輯狀態為「未完成」的退貨單

As a 倉儲人員,
I want 編輯狀態為「未完成」的退貨單（退貨數量、備註、新增／刪除商品、檔案上傳）,
So that 我可以修改退貨單的內容並與後台資料連動。

**Acceptance Criteria:**

**Given** 倉儲人員在退貨單列表頁面，某個退貨單狀態為「未完成」
**When** 點擊該退貨單的「編輯」進入退貨單編輯頁
**Then** 進入退貨單編輯頁
**And** 頁面純顯示欄位：退貨單號、建立日期、原配送單號、客戶簡稱、溫層、退貨類型（必為「回廠退」）、狀態（必為「未完成」）
**And** 顯示[返回]按鈕（返回列表頁）與[儲存]按鈕（跳出提示「儲存成功」後返回列表頁）
**And** 倉儲人員可以編輯退貨數量、備註、新增／刪除商品、檔案上傳（FR56）
**And** 退貨數量自動帶入該商品的最小單位顯示（FR56.1）
**And** [新增商品]燈箱依照客戶簡稱及溫層篩選可選擇的商品選項（FR56.2）
**And** 僅透過[新增商品]新增的商品可刪除，原有商品不可刪除（FR56.3）
**And** 檔案上傳預設帶入與原配送單號關聯的異常回報圖片，僅可上傳 PDF、PNG、JPG 檔（FR56.4）
**And** 儲存時資料與後台【退貨單列表】該筆資料相互連動（FR56.5）
**And** 頁面載入時間 < 2 秒（NFR2）

### Story 6.5: 倉儲人員可以查看退貨單（已彙整+回廠退，或已立單+直退）

As a 倉儲人員,
I want 查看退貨單（唯讀）：狀態為「已彙整」且退貨類型為「回廠退」，或狀態為「已立單」且退貨類型為「直退」,
So that 我可以了解退貨單的完整資訊。

**Acceptance Criteria:**

**Given** 倉儲人員在退貨單列表頁面，某個退貨單符合查看條件（已彙整+回廠退，或已立單+直退）
**When** 點擊該退貨單的「查看」按鈕
**Then** 系統進入退貨單查看頁，顯示唯讀模式（FR57）
**And** 退貨類型為「回廠退」時，狀態必為「已彙整」；退貨類型為「直退」時，狀態必為「已立單」
**And** 頁面顯示：退貨單號、建立日期、原配送單號、客戶簡稱、溫層、退貨類型、狀態、退貨資訊（品名、退貨數量、備註）、退貨備註、檔案上傳
**And** 系統顯示完整的退貨單資訊和商品內容
**And** 系統不允許編輯退貨單內容
**And** 頁面載入時間 < 2 秒（NFR2）

### Story 6.6: 倉儲人員可以編輯狀態為「待立單」的彙整單

As a 倉儲人員,
I want 編輯狀態為「待立單」的彙整單（退貨數量、備註、新增／刪除商品、檔案上傳）,
So that 我可以調整彙整單內容後送立單。

**Acceptance Criteria:**

**Given** 倉儲人員在退貨單列表頁面，某張彙整單狀態為「待立單」
**When** 點擊進入彙整單編輯頁
**Then** 倉儲人員可以編輯退貨數量、備註、新增／刪除商品、檔案上傳（FR57.1）
**And** 彙整單退貨資料依後台【碼頭管理 > 退貨單列表】該筆彙整單資料顯示（FR57.2）
**And** 備註預設帶入【後台 > 派車任務管理 > 退貨單列表 > 詳細頁】的備註內容（FR57.3）
**And** [新增商品]燈箱顯示商品代號／商品名稱／商品簡稱，依客戶簡稱及溫層篩選（FR57.4）
**And** 頁面純顯示欄位：退貨單號、建立日期、原退貨單號、客戶簡稱、溫層、退貨類型（必為「彙整單」）、狀態（必為「待立單」）
**And** 顯示[返回]按鈕（返回列表頁）與[儲存]按鈕（跳出提示「儲存成功」後返回列表頁）
**And** 頁面載入時間 < 2 秒（NFR2）

### Story 6.7: 倉儲人員可以查看狀態為「已立單」且類型為「彙整單」的彙整單（唯讀）

As a 倉儲人員,
I want 查看狀態為「已立單」且類型為「彙整單」的彙整單,
So that 我可以了解已完成立單的彙整單資訊。

**Acceptance Criteria:**

**Given** 倉儲人員在退貨單列表頁面，某張彙整單狀態為「已立單」且類型為「彙整單」
**When** 點擊該彙整單的「查看」按鈕
**Then** 系統進入彙整單查看頁，顯示唯讀模式（FR58）
**And** 系統顯示完整彙整單資訊
**And** 頁面顯示：退貨單號、建立日期、原退貨單號、客戶簡稱、溫層、退貨類型（彙整單）、狀態（已立單）、退貨資訊（品名、退貨數量、備註）、退貨備註、檔案上傳
**And** 系統不允許編輯
**And** 系統整合運務 APP 和後台退貨單資料顯示（FR58.1）
**And** 頁面載入時間 < 2 秒（NFR2）

## Epic 7: 即時同步與通知基礎設施

系統可以即時同步狀態與發送通知，確保多裝置即時同步與通知功能正常運作。

**FRs covered:** FR59, FR60, FR61, FR62, FR63, FR64, FR65

### Story 7.1: 系統可以維持即時雙向連線

As a 系統,
I want 維持即時雙向連線,
So that 系統可以即時同步資料和發送通知。

**Acceptance Criteria:**

**Given** 倉儲人員已登入系統
**When** 系統初始化
**Then** 系統建立即時雙向連線，確保資料即時同步（FR61）
**And** 即時連線穩定性：連線中斷率 < 0.1%（NFR7）
**And** 系統使用加密連線（NFR20）
**And** 連線建立後系統維持連線狀態

### Story 7.2: 系統可以即時同步後台操作到前端顯示

As a 倉儲人員,
I want 系統即時同步後台操作到前端顯示,
So that 我可以看到最新的資料變化。

**Acceptance Criteria:**

**Given** 倉儲人員已登入系統並建立即時連線
**When** 後台發生資料變更操作（如狀態變更、資料更新等）
**Then** 系統即時同步後台操作到前端顯示（FR59）
**And** 後台操作反映時間 < 3 秒（NFR5）
**And** 狀態變更同步準確率 100%（NFR6）
**And** 多裝置同步延遲 < 3 秒（NFR8）

### Story 7.3: 系統可以即時同步前端操作到後台和其他裝置

As a 倉儲人員,
I want 系統即時同步前端操作到後台和其他裝置,
So that 其他裝置可以看到我的操作結果。

**Acceptance Criteria:**

**Given** 倉儲人員已登入系統並建立即時連線
**When** 倉儲人員在前端進行操作（如修改狀態、更新資料等）
**Then** 系統即時同步前端操作到後台（FR60）
**And** 系統同步前端操作到其他裝置（FR60）
**And** 狀態變更同步準確率 100%（NFR6）
**And** 多裝置同步延遲 < 3 秒（NFR8）

### Story 7.4: 系統可以在網路中斷時提示使用者

As a 倉儲人員,
I want 系統在網路中斷時提示我,
So that 我可以知道網路連線狀態並採取適當行動。

**Acceptance Criteria:**

**Given** 倉儲人員已登入系統並建立即時連線
**When** 網路連線中斷
**Then** 系統偵測到網路中斷並提示使用者（FR62）
**And** 系統顯示網路中斷提示訊息
**And** 系統在網路恢復後自動重新連線（NFR32）
**And** 網路中斷處理：提示使用者，並在恢復後自動重新連線（NFR32）

### Story 7.5: 系統可以支援多裝置同時監控並保持資料同步

As a 倉儲人員,
I want 系統支援多裝置同時監控並保持資料同步,
So that 我可以在不同裝置上看到相同的資料。

**Acceptance Criteria:**

**Given** 倉儲人員在多個裝置上登入系統
**When** 任一裝置發生資料變更
**Then** 系統支援多裝置同時監控並保持資料同步（FR63）
**And** 所有裝置的資料保持同步
**And** 多裝置同步延遲 < 3 秒（NFR8）
**And** 系統穩定性：支援多裝置同時監控，具備斷線提示與容錯（NFR27）

### Story 7.6: 系統可以發送推播通知到運務 APP

As a 系統,
I want 發送推播通知到運務 APP,
So that 我可以通知運務相關的狀態變更或重要訊息。

**Acceptance Criteria:**

**Given** 系統需要發送通知給運務（如出貨通知、下貨碼頭通知等）
**When** 系統觸發推播通知
**Then** 系統發送推播通知到運務 APP（FR64）
**And** 系統整合現有通知系統（PushServiceProvider）
**And** 推播通知整合：發送推播通知到運務 APP（NFR41）
**And** 通知發送成功率 > 99.5%

### Story 7.7: 系統可以接收運務 APP 回報的狀態

As a 系統,
I want 接收運務 APP 回報的狀態,
So that 我可以即時更新任務狀態。

**Acceptance Criteria:**

**Given** 運務透過運務 APP 回報狀態（如回廠下貨）
**When** 系統接收運務 APP 回報的狀態
**Then** 系統接收運務 APP 回報的狀態並更新任務狀態（FR65）
**And** 系統整合運務 APP 整合：接收運務 APP 回報的狀態（NFR40）
**And** 狀態更新即時反映在相關頁面（< 3 秒）（NFR5）
**And** 狀態變更同步準確率 100%（NFR6）

### Story 7.8: 即時連線恢復機制

As a 系統,
I want 即時連線中斷時自動重連,
So that 我可以確保資料不遺失並維持即時同步。

**Acceptance Criteria:**

**Given** 倉儲人員已登入系統，即時連線中斷
**When** 系統偵測到連線中斷
**Then** 系統自動嘗試重新建立即時連線（NFR33）
**And** 即時連線恢復：連線中斷時自動重連，確保資料不遺失（NFR33）
**And** 系統在重連期間暫存操作（離線功能）
**And** 連線恢復後自動同步暫存的操作（NFR32）

### Story 7.9: 即時通訊失敗時的降級方案

As a 系統,
I want 在即時通訊失敗時提供降級方案,
So that 系統在即時連線不可用時仍能運作。

**Acceptance Criteria:**

**Given** 系統無法建立或維持即時連線
**When** 即時通訊失敗
**Then** 系統提供降級方案（如輪詢）（NFR35）
**And** 降級方案：即時通訊失敗時提供降級方案（如輪詢）（NFR35）
**And** 系統透過降級方案維持資料同步
**And** 即時連線恢復後自動切換回即時連線

## Epic 8: 後台管理功能擴充

後台管理員可以查看退貨單列表、查詢倉儲收貨資訊、同步查看前台資料、修改前台資料等管理功能。

**FRs covered:** FR68, FR68.1-FR68.14, FR69, FR69.1-FR69.19, FR70, FR71

### Story 8.1: 後台管理員可以查看退貨單列表

As a 後台管理員,
I want 在後台查看退貨單列表,
So that 我可以管理所有退貨單資料。

**Acceptance Criteria:**

**Given** 後台管理員已登入後台系統
**When** 進入「碼頭管理 > 退貨單列表」頁面
**Then** 系統顯示所有退貨單列表（FR68）
**And** 搜尋欄位：關鍵字（退貨單號、原配送單號）、建立日期（日期區間）、客戶簡稱（搜尋下拉選單）、溫層（下拉選單/冷藏/冷凍/常溫+特殊溫層）、退貨類型（下拉選單/直退/回廠退/彙整單）、退貨廠區（下拉選單）、狀態（下拉選單/未完成/已彙整/待立單/已立單）、退貨配送單狀態（下拉選單）（FR68.1）
**And** 列表顯示欄位：勾選格、退貨單號、建立日期、原配送單號、客戶簡稱、溫層、退貨類型、退貨廠區、狀態、退貨配送單號、退貨配送單狀態、操作（FR68.2）
**And** 列表資料來源：運務APP【異常回報-退貨】產生的直退&回廠退退貨單、後台新增之回廠退退貨單、前後台合併未完成退貨單產生的彙整單（FR68.3）
**And** 操作按鈕規則：狀態為「未完成」顯示[編輯]按鈕（進入退貨單編輯頁）；狀態為「待立單」顯示[編輯]按鈕（進入彙整單編輯頁）；狀態為「已彙整」或「已立單」顯示[查看]按鈕（FR68.7）
**And** API 響應時間 < 300ms（NFR1）

### Story 8.1.1: 後台管理員可以彙整退貨單

As a 後台管理員,
I want 點擊[彙整退貨單]按鈕將勾選的退貨單合併成一張彙整單,
So that 我可以將同廠區同客戶同溫層的退貨單合併處理。

**Acceptance Criteria:**

**Given** 後台管理員在退貨單列表頁面
**When** 勾選一筆或多筆退貨單，點擊[彙整退貨單]按鈕
**Then** 系統驗證被勾選的退貨單須同退貨廠區、同客戶簡稱、同溫層（FR68.4）
**And** 若不符，跳提示文字「請選擇同退貨廠區、同客戶簡稱、同溫層的未完成退貨單」
**And** 彙整單號規則：BA+yyyymmdd+00001（流水號）（FR68.5）
**And** 被合併的原退貨單狀態變為「已彙整」（FR68.6）
**And** 彙整單同步顯示於前台退貨作業列表頁
**And** 操作響應時間 < 500ms（NFR3）

**備註：** 後台彙整規則與前台差異——後台要求「同退貨廠區」，前台不要求。

### Story 8.1.2: 後台管理員可以新增退貨單

As a 後台管理員,
I want 在後台新增退貨單,
So that 我可以建立回廠退退貨單。

**Acceptance Criteria:**

**Given** 後台管理員在退貨單列表頁面點擊[新增]按鈕
**When** 進入退貨單新增頁
**Then** 顯示欄位：客戶簡稱*（搜尋下拉選單）、溫層*（下拉選單）、退貨類型（純顯示/固定為「回廠退」）、退貨廠區*（下拉選單）、退貨資訊（表格）、退貨單備註（文字段落）、檔案上傳（多檔上傳/限PDF、PNG、JPG）（FR68.8）
**And** 退貨資訊表格欄位：商品名稱、退貨數量（數字框+最小單位）、備註（FR68.9）
**And** 點擊[新增商品]按鈕跳出新增商品組燈箱
**And** 顯示[返回]和[送出]按鈕
**And** 點擊[送出]時產生退貨單號規則：B+yyyymmdd+00001（流水號），預設狀態為「未完成」（FR68.10）
**And** 頁面載入時間 < 2 秒（NFR2）

### Story 8.1.3: 後台管理員可以編輯退貨單

As a 後台管理員,
I want 編輯狀態為「未完成」的退貨單,
So that 我可以修改退貨單的內容。

**Acceptance Criteria:**

**Given** 後台管理員在退貨單列表頁面，某退貨單狀態為「未完成」
**When** 點擊[編輯]按鈕進入退貨單編輯頁
**Then** 頁面純顯示欄位：退貨單號、建立日期、原配送單號、客戶簡稱、溫層、退貨類型、退貨廠區、狀態（FR68.11）
**And** 退貨資訊表格可編輯：退貨數量、備註
**And** 可透過[新增商品]按鈕新增商品，僅新增的商品可刪除
**And** 檔案上傳（多檔上傳/限PDF、PNG、JPG）
**And** 顯示[返回]和[儲存]按鈕
**And** 儲存後資料連動前台退貨作業對應退貨單
**And** 頁面載入時間 < 2 秒（NFR2）

### Story 8.1.4: 後台管理員可以查看退貨單（唯讀）

As a 後台管理員,
I want 查看狀態為「已彙整」或「已立單」的退貨單,
So that 我可以了解退貨單的完整資訊。

**Acceptance Criteria:**

**Given** 後台管理員在退貨單列表頁面，某退貨單狀態為「已彙整」或「已立單」
**When** 點擊[查看]按鈕進入退貨單查看頁
**Then** 系統顯示完整退貨單資訊（純顯示，不可編輯）（FR68.12）
**And** 顯示退貨單號、建立日期、原配送單號、客戶簡稱、溫層、退貨類型、退貨廠區、狀態、退貨配送單號、退貨配送單狀態
**And** 顯示退貨資訊表格（品名、退貨數量、備註）
**And** 顯示退貨單備註、檔案上傳
**And** 顯示[返回]按鈕
**And** 頁面載入時間 < 2 秒（NFR2）

### Story 8.1.5: 後台管理員可以編輯彙整單

As a 後台管理員,
I want 編輯狀態為「待立單」的彙整單,
So that 我可以調整彙整單內容。

**Acceptance Criteria:**

**Given** 後台管理員在退貨單列表頁面，某彙整單狀態為「待立單」
**When** 點擊[編輯]按鈕進入彙整單編輯頁
**Then** 頁面顯示原退貨單號（純顯示）（FR68.13）
**And** 退貨資訊預設帶入原退貨單商品（同商品合併）
**And** 退貨資訊表格可編輯：退貨數量、備註
**And** 可透過[新增商品]按鈕新增商品，僅新增的商品可刪除
**And** 檔案上傳（多檔上傳/預設帶入原退貨單檔案）
**And** 顯示[返回]和[儲存]按鈕
**And** 儲存後資料連動前台退貨作業對應彙整單
**And** 頁面載入時間 < 2 秒（NFR2）

### Story 8.1.6: 後台管理員可以查看彙整單（唯讀）

As a 後台管理員,
I want 查看狀態為「已立單」的彙整單,
So that 我可以了解已完成立單的彙整單資訊。

**Acceptance Criteria:**

**Given** 後台管理員在退貨單列表頁面，某彙整單狀態為「已立單」且類型為「彙整單」
**When** 點擊[查看]按鈕進入彙整單查看頁
**Then** 系統顯示完整彙整單資訊（純顯示，不可編輯）（FR68.14）
**And** 顯示退貨單號、建立日期、原退貨單號、客戶簡稱、溫層、退貨類型、退貨廠區、狀態、退貨配送單號、退貨配送單狀態
**And** 顯示退貨資訊表格（品名、退貨數量、備註）
**And** 顯示退貨備註、檔案上傳
**And** 顯示[返回]按鈕
**And** 頁面載入時間 < 2 秒（NFR2）

### Story 8.2: 後台管理員可以查詢倉儲收貨資訊

As a 後台管理員,
I want 查詢倉儲收貨資訊,
So that 我可以了解所有收貨作業的詳細資訊。

**Acceptance Criteria:**

**Given** 後台管理員已登入後台系統
**When** 進入「倉儲收貨管理 > 倉儲收貨資訊查詢」頁面
**Then** 系統顯示倉儲收貨資訊查詢列表頁（FR69）
**And** 搜尋欄位：關鍵字搜尋（配送任務單號）、回廠時間（日期區間）、收貨類型（下拉選單/入庫分貨or越庫作業）、收貨配送點（搜尋下拉選單）、收貨廠區（搜尋下拉選單）、客戶簡稱（搜尋下拉選單）、處理狀態（下拉選單/接貨中or回廠下貨or下貨完成）、收貨人員（搜尋下拉選單）（FR69.1）
**And** 列表顯示欄位：回報時間、配送任務單號、類型、收貨配送點、收貨廠區、客戶簡稱、處理狀態、收貨人員、是否異動、操作（FR69.2）
**And** 顯示所有配送任務中有「收貨」的配送單，相同配送任務一個貨主x配送點為一列（FR69.3）
**And** 排序規則：先依狀態（回廠下貨>接貨中>下貨完成），同狀態依回報時間降冪（FR69.4）
**And** 收貨類型於後台配送任務建立當下即紀錄於資料庫（入庫分貨／越庫作業），前台直接讀取顯示（FR69.5）
**And** 處理狀態預設為「接貨中」，運務APP點擊[回廠下貨]後變為「回廠下貨」，碼頭前台簽名後變為「下貨完成」（FR69.6）
**And** 是否異動預設為「否」，下貨完成後後台修改則記錄為「是」（FR69.7）
**And** 查詢響應時間 < 1 秒（NFR12）

### Story 8.2.1: 後台管理員可以編輯入庫分貨收貨資訊

As a 後台管理員,
I want 編輯入庫分貨類型的收貨資訊,
So that 我可以修改入庫分貨的收貨明細並連動前台。

**Acceptance Criteria:**

**Given** 後台管理員在倉儲收貨資訊查詢列表頁，點擊某筆入庫分貨類型的[編輯]按鈕
**When** 進入入庫分貨編輯頁
**Then** 頁面純顯示欄位：回報時間、配送任務單號、類型（入庫分貨）、收貨廠區、收貨配送點、客戶簡稱、運務員簽名（圖檔）、處理狀態（FR69.8）
**And** 收貨資訊表格欄位：品名（純顯示）、單據入數（純顯示）、單據件數（純顯示）、單據板位（純顯示）、實收數量（數字框/可編輯）、有效日期（日期選單/可編輯）、備註（文字框/可編輯）（FR69.9）
**And** 單據入數/件數/板位預設顯示運務APP配送單起點回報數值（FR69.10）
**And** 單筆商品可新增多組[實收數量]+[有效日期]，超過一組才顯示刪除按鈕（FR69.11）
**And** 原配送單內收貨商品不可刪除，後台新增商品才顯示刪除按鈕（FR69.12）
**And** 顯示[返回]和[儲存]按鈕
**And** 儲存時收貨資訊連動【碼頭前台>收貨作業>入庫分貨詳細頁】顯示（FR69.13）
**And** 頁面載入時間 < 2 秒（NFR2）

### Story 8.2.2: 後台管理員可以編輯越庫作業收貨資訊

As a 後台管理員,
I want 編輯越庫作業類型的收貨資訊,
So that 我可以修改越庫作業的收貨明細並連動前台。

**Acceptance Criteria:**

**Given** 後台管理員在倉儲收貨資訊查詢列表頁，點擊某筆越庫作業類型的[編輯]按鈕
**When** 進入越庫作業編輯頁
**Then** 頁面純顯示欄位同入庫分貨編輯頁（FR69.14）
**And** 收貨資訊表格欄位：商品名稱（純顯示）、起點單據板位（純顯示）、實收板位（數字框/可編輯）、備註（文字框/可編輯）、迄點單據板位（純顯示）、配送點（搜尋下拉選單/抓同客戶關聯所有啟用的常態配送點）、配送日期（日期選單/可編輯）（FR69.15, FR69.16）
**And** 可新增多筆商品項目，單一商品可新增多組配送點資料（FR69.17）
**And** 原配送單內收貨商品不可刪除，後台新增商品才可刪除（FR69.18）
**And** 顯示[返回]和[儲存]按鈕
**And** 儲存時收貨資訊連動【碼頭前台>收貨作業>越庫作業詳細頁】顯示（FR69.19）
**And** 頁面載入時間 < 2 秒（NFR2）

### Story 8.3: 後台管理員可以同步查看前台資料

As a 後台管理員,
I want 同步查看前台資料,
So that 我可以即時了解前台的作業狀況。

**Acceptance Criteria:**

**Given** 後台管理員已登入後台系統
**When** 查看任何前台相關資料（出貨作業、收貨作業、退貨作業等）
**Then** 系統同步查看前台資料（FR70）
**And** 系統即時同步，後台操作即時反映在前端
**And** 前台操作即時反映在後台
**And** 多裝置同步延遲 < 3 秒（NFR8）

### Story 8.4: 後台管理員可以修改前台資料（依照權限）

As a 後台管理員,
I want 修改前台資料（依照權限）,
So that 我可以協助處理前台的異常情況或資料修正。

**Acceptance Criteria:**

**Given** 後台管理員已登入後台系統，具有相應權限
**When** 嘗試修改前台資料
**Then** 系統驗證後台管理員的權限（FR71）
**And** 如果具有權限，系統允許修改前台資料
**And** 如果沒有權限，系統顯示錯誤提示並阻止操作
**And** 修改後的資料即時同步到前台（< 3 秒）（NFR5）
**And** 操作記錄被記錄（為 Epic 9 做準備）

### Story 8.5: 後台管理員可以在區塊內容管理中新增「碼頭-忘記密碼」功能

As a 後台管理員,
I want 在區塊內容管理中新增「碼頭-忘記密碼」功能,
So that 我可以設定前台忘記密碼頁面顯示的提示文字。

**Acceptance Criteria:**

**Given** 後台管理員已登入後台系統
**When** 進入「網站管理 > 區塊內容管理」頁面
**Then** 系統顯示新增的「碼頭-忘記密碼」功能選項
**And** 後台管理員可以編輯「碼頭-忘記密碼」的提示文字
**And** 編輯後的提示文字即時串聯到前台忘記密碼頁面顯示（Epic 2）
**And** 操作記錄被記錄（為 Epic 9 做準備）

### Story 8.6: 後台管理員可以在內部廠區編輯頁新增「入庫分貨配送點燈箱」

As a 後台管理員,
I want 在內部廠區編輯頁新增「入庫分貨配送點燈箱」,
So that 我可以設定內部廠區關聯的入庫分貨配送點。

**Acceptance Criteria:**

**Given** 後台管理員已登入後台系統
**When** 進入「配送點管理 > 內部廠區」編輯頁面
**Then** 系統顯示新增的「入庫分貨配送點燈箱」功能
**And** 後台管理員可以選擇與所選內部廠區關聯的入庫分貨配送點
**And** 設定的關聯關係用於收貨作業自動判斷收貨明細類型（Epic 5）
**And** 操作記錄被記錄（為 Epic 9 做準備）

## Epic 9: 資料整合與審計

系統可以與現有後台系統整合資料，記錄所有狀態變更操作，確保資料一致性與可追溯性。

**FRs covered:** FR72, FR73, FR74, FR75, FR76

### Story 9.1: 系統可以與現有後台系統整合資料

As a 系統,
I want 與現有後台系統整合資料,
So that 資料來源統一，確保系統間資料一致性。

**Acceptance Criteria:**

**Given** 系統需要存取或更新資料
**When** 系統進行資料操作
**Then** 系統與現有後台系統整合資料（FR72）
**And** 系統整合現有後台系統架構（Controllers、Models、Services、Routes）
**And** 系統遵循現有 API 設計模式
**And** 系統整合現有資料模型（配送單、配送任務、車輛等）
**And** 後台系統整合：與現有後台系統完整整合資料（NFR36）
**And** 資料格式相容：確保與現有系統的資料格式相容（NFR42）

### Story 9.2: 系統可以自動驗證與現有系統的資料同步結果並回報不一致

As a 系統,
I want 自動驗證與現有系統的資料同步結果，偵測並回報資料不一致,
So that 所有系統的資料保持一致，異常可被發現。

**Acceptance Criteria:**

**Given** 系統進行資料同步操作
**When** 資料在系統間同步
**Then** 系統自動驗證與現有系統的資料同步結果，偵測並回報資料不一致（FR73）
**And** 與現有系統資料同步準確率：100%（NFR28）
**And** 資料一致性：確保所有整合系統的資料同步一致（NFR44）
**And** 資料遺失率：0%（NFR29）

### Story 9.3: 系統可以記錄所有狀態變更操作

As a 系統,
I want 記錄所有狀態變更操作,
So that 我可以追蹤所有重要的操作記錄。

**Acceptance Criteria:**

**Given** 系統發生狀態變更操作（如車輛狀態變更、收貨狀態變更等）
**When** 操作執行
**Then** 系統記錄所有狀態變更操作（FR74）
**And** 操作記錄：記錄所有狀態變更操作（NFR22）
**And** 記錄包含操作時間、操作人員、操作內容、操作前後狀態等資訊
**And** 記錄儲存至資料庫，確保可查詢

### Story 9.4: 系統可以追溯所有操作的歷史記錄

As a 後台管理員,
I want 追溯所有操作的歷史記錄,
So that 我可以了解資料變更的完整歷程。

**Acceptance Criteria:**

**Given** 後台管理員需要查看操作歷史記錄
**When** 查詢特定資料的操作歷史
**Then** 系統追溯所有操作的歷史記錄（FR75）
**And** 審計日誌：可追溯所有操作的歷史記錄（NFR23）
**And** 系統顯示完整的操作歷史（時間、人員、操作內容、狀態變更等）
**And** 查詢響應時間 < 1 秒（NFR12）

### Story 9.5: 系統可以驗證資料完整性

As a 系統,
I want 驗證資料完整性,
So that 我可以確保資料的正確性和一致性。

**Acceptance Criteria:**

**Given** 系統進行資料操作或同步
**When** 資料寫入或更新
**Then** 系統驗證資料完整性（FR76）
**And** 資料完整性：100%（NFR30）
**And** 系統驗證必填欄位、資料格式、關聯資料完整性等
**And** 如果資料不完整，系統顯示錯誤提示並阻止操作
**And** 資料完整性驗證在資料庫層級和應用層級實作

## Epic 10: 後台既有功能擴增

後台管理員可以使用擴增的既有功能，包括通知管理、配送點管理、配送單管理等功能的新增欄位與操作。

**FRs covered:** FR77-FR77.2, FR78-FR78.5, FR79-FR79.7, FR80-FR80.3, FR81-FR81.3, FR82-FR82.5, FR83-FR83.5, FR84-FR84.3, FR85

### Story 10.1: 區塊內容管理新增「碼頭-忘記密碼」功能

As a 後台管理員,
I want 在區塊內容管理中設定碼頭忘記密碼提示文字,
So that 碼頭前台登入頁可以顯示忘記密碼的說明。

**Acceptance Criteria:**

**Given** 後台管理員進入「網站管理 > 區塊內容管理」
**When** 查看區塊內容管理列表
**Then** 在[網頁忘記密碼]下方顯示[碼頭-忘記密碼]設定區塊
**And** 點擊進入編輯頁，顯示欄位：內文*（文字段落）
**And** 內文內容串接碼頭前台登入頁忘記密碼燈箱顯示（Epic 2）
**And** 操作記錄被記錄（為 Epic 9 做準備）

### Story 10.2: 通知列表新增碼頭人員發送類型

As a 後台管理員,
I want 在通知列表中選擇碼頭人員作為發送對象,
So that 我可以發送站內信給碼頭人員。

**Acceptance Criteria:**

**Given** 後台管理員進入「通知管理 > 通知列表」點擊[新增]
**When** 進入通知列表新增頁
**Then** 發送類型下拉選單新增兩種選項：全部碼頭人員、特定碼頭人員
**And** 只有[訊息類型]選擇「站內信」時，才可選擇碼頭人員
**And** 選擇「特定碼頭人員」時顯示[選擇碼頭人員]按鈕
**And** 點擊[選擇碼頭人員]跳出燈箱

### Story 10.3: 選擇碼頭人員燈箱功能

As a 後台管理員,
I want 在燈箱中選擇特定碼頭人員,
So that 我可以指定通知發送對象。

**Acceptance Criteria:**

**Given** 後台管理員在通知列表新增頁點擊[選擇碼頭人員]
**When** 跳出選擇碼頭人員燈箱
**Then** 燈箱搜尋欄位：關鍵字搜尋（碼頭人員帳號/人員姓名/所屬廠區）
**And** 燈箱列表抓【碼頭管理>碼頭人員列表】所有啟用中的人員資訊
**And** 燈箱列表顯示：勾選欄位、人員帳號、人員姓名、所屬廠區
**And** 可多選發送對象
**And** 點擊[確定]後關閉燈箱，顯示已選擇的碼頭人員

### Story 10.4: 內部廠區新增入庫分貨配送點燈箱

As a 後台管理員,
I want 在內部廠區編輯頁設定入庫分貨配送點,
So that 系統可以自動判斷收貨明細類型。

**Acceptance Criteria:**

**Given** 後台管理員進入「配送點管理 > 內部廠區」點擊[新增]或[編輯]
**When** 進入內部廠區新增/編輯頁
**Then** 新增[入庫分貨配送點]按鈕
**And** 點擊[入庫分貨配送點]開啟燈箱
**And** 燈箱搜尋欄位：關鍵字搜尋（配送點代號、配送點簡稱、地址）、客戶簡稱（搜尋下拉選單）、區域（下拉選單/北區、中區、南區、東區、花東區）、班別（下拉選單/早班、午班、晚班）
**And** 燈箱列表顯示【配送點管理>配送點列表】所有配送點資料
**And** 燈箱列表欄位：勾選欄位、配送點代號、配送點簡稱、客戶簡稱、區域、班別、收/送貨地址
**And** 可勾選多筆配送點與內部廠區建立關聯
**And** 可取消勾選多筆配送點與內部廠區解除關聯
**And** 點擊[儲存]時顯示所選入庫分貨配送點

### Story 10.5: 配送單管理新增作業類型欄位

As a 後台管理員,
I want 在配送單管理中區分配送作業和退貨作業,
So that 我可以管理不同類型的配送單。

**Acceptance Criteria:**

**Given** 後台管理員進入「配送單管理 > 配送單管理」
**When** 查看配送單管理列表
**Then** 搜尋欄位新增：作業類型（下拉選單/配送作業/退貨作業）
**And** 列表新增欄位顯示[作業類型]，固定為：配送作業/退貨作業
**And** 現有資料皆帶入為配送作業
**And** 判斷作業類型為「退貨作業」時，不顯示[複製]按鈕及[編輯]按鈕

### Story 10.6: 配送單新增頁新增作業類型選項

As a 後台管理員,
I want 在新增配送單時選擇作業類型,
So that 我可以建立配送作業或退貨作業的配送單。

**Acceptance Criteria:**

**Given** 後台管理員進入「配送單管理 > 配送單管理」點擊[新增]
**When** 進入配送單新增頁
**Then** 新增欄位：作業類型*（單選/配送作業、退貨作業）
**And** 作業類型預設選擇為「配送作業」
**And** 選擇「配送作業」同目前操作流程
**And** 選擇「退貨作業」顯示退貨作業專用欄位

### Story 10.7: 退貨作業新增頁欄位

As a 後台管理員,
I want 建立退貨作業的配送單,
So that 我可以處理退貨物流。

**Acceptance Criteria:**

**Given** 後台管理員在配送單新增頁選擇作業類型為「退貨作業」
**When** 顯示退貨作業專用欄位
**Then** 顯示欄位：
  - 作業類型*（固定為退貨作業）
  - 客戶簡稱*（搜尋下拉選單）
  - 配送溫層*（下拉選單/冷藏(0-7度C)、冷凍(-18度C)、常溫+特殊溫層）
  - 選擇退貨單（燈箱）
  - 配送起點*（搜尋下拉選單/關聯該客戶的配送點）
  - 取貨日期*（日期套件）
  - 起點收貨商品（燈箱/預設帶入選擇退貨單的商品品項和入數）
  - 文件檔案（多檔上傳/預設帶入退貨單上傳的檔案）
  - 備註（文字段落/預設帶入「退貨」兩字及退貨單設定的備註內容）
  - 配送迄點*（搜尋下拉選單）
  - 配送日期*（日期套件）
  - 迄點送貨商品*（燈箱/預設帶入選擇退貨單的商品品項和入數）
**And** 客戶簡稱有編輯時清除配送溫層選擇的項目
**And** 可新增多個配送迄點
**And** 退貨作業沒有[暫存]按鈕功能
**And** 從退貨單帶入的商品不可修改，自行新增的商品才可以
**And** 起點收貨商品/迄點送貨商品表格欄位：送/收、商品名稱、入數（數字框+最小單位）、件數（數字框+中級單位）、單板件數、板位（自動計算）

### Story 10.8: 選擇退貨單燈箱功能

As a 後台管理員,
I want 在退貨作業中選擇退貨單,
So that 我可以將退貨單資訊帶入配送單。

**Acceptance Criteria:**

**Given** 後台管理員在退貨作業新增頁點擊[選擇退貨單]
**When** 跳出選擇退貨單燈箱
**Then** 燈箱搜尋欄位：關鍵字搜尋（退貨單號）、建立日期（日期區間）、退貨廠區（下拉選單）
**And** 燈箱列表依照所選客戶簡稱及溫層，顯示【碼頭管理>退貨單列表】狀態為「待立單」的彙整單資料
**And** 燈箱列表欄位：勾選欄位、退貨單號、建立日期、客戶簡稱、溫層、退貨廠區、商品資訊
**And** 可勾選多筆退貨彙整單建立退貨配送單資訊
**And** 商品資訊欄位點擊跳燈箱顯示該筆退貨單商品資訊（商品名稱、退貨數量、備註）
**And** 點擊[儲存]時配送單帶入所選退貨單的商品資訊、退貨單備註、檔案上傳

### Story 10.9: 退貨作業送出驗證

As a 系統,
I want 驗證退貨作業起迄點商品數量,
So that 確保退貨作業資料正確。

**Acceptance Criteria:**

**Given** 後台管理員在退貨作業新增頁點擊[送出]
**When** 系統驗證同一組起點中，同商品的起點、迄點總和
**Then** 若相同：配送單管理單據狀態為「已送出」，配送單查詢狀態為「訂單確認中」
**And** 若不同：跳警告燈箱文字顯示「[商品名稱]起點數量與迄點數量總和不相符，請重新調整」
**And** 將下單日期顯示為送出時的日期
**And** 將這筆退貨作業選到的彙整單於【後台>退貨單列表】、【碼頭前台>退貨作業_列表頁】狀態更新為已立單
**And** 將這筆配送單號回寫到【後台>退貨單列表】的退貨配送單號，同步顯示退貨配送單狀態

### Story 10.10: 配送單查看頁顯示作業類型

As a 後台管理員,
I want 在配送單查看頁看到作業類型,
So that 我可以區分配送作業和退貨作業。

**Acceptance Criteria:**

**Given** 後台管理員進入配送單查看頁
**When** 查看配送單詳細資訊
**Then** 新增顯示欄位：作業類型（配送作業or退貨作業）

## Epic 11: 運務APP功能擴增

運務人員可以使用擴增的APP功能，包括回廠下貨按鈕和退貨異常回報功能。

**FRs covered:** 對應 PRD Section 6 運務APP整合需求

### Story 11.1: 配送任務新增回廠下貨功能

As a 運務人員,
I want 在配送任務中點擊回廠下貨按鈕,
So that 我可以通知碼頭人員我即將回廠下貨。

**Acceptance Criteria:**

**Given** 運務人員在運務APP查看配送任務
**When** 任務內配送單有送貨且已收貨完畢的趟次表
**Then** 顯示[回廠下貨]按鈕
**And** 點擊按鈕後顏色改變，顯示預設文字「碼頭確認中」
**And** 待碼頭前台確認下貨碼頭後，文字改為「[該下貨碼頭名稱]」，不可再次點擊
**And** 後台【倉儲收貨管理>倉儲收貨資訊查詢】該筆配送任務處理狀態變為「回廠下貨」
**And** 碼頭前台【收貨作業列表】該筆配送任務狀態改為「回廠下貨」
**And** 發送自動通知給任務迄點同所屬廠區的碼頭人員前台
**And** 記錄當下時間為回報時間
**And** 將當下經緯度資料轉為地址形式（串接Google Map API），紀錄顯示於碼頭前台【收貨作業列表】
**And** 經緯度資料來源為衛星犬API

### Story 11.2: 異常回報新增退貨類型欄位

As a 運務人員,
I want 在異常回報退貨時選擇退貨類型,
So that 我可以區分直退和回廠退。

**Acceptance Criteria:**

**Given** 運務人員在運務APP進入異常回報-退貨
**When** 填寫退貨異常回報
**Then** 新增欄位：退貨類型*（單選/直退、回廠退）
**And** 若選擇「回廠退」：顯示內部廠區*（下拉選單/抓【配送點管理>內部廠區】所有啟用的內部廠區名稱）
**And** 若選擇「直退」：顯示退貨迄點*（下拉選單/抓【配送點管理>配送點列表】同所選客戶簡稱的配送點簡稱）

### Story 11.3: 回廠退退貨單建立

As a 系統,
I want 在運務送出回廠退異常回報時建立退貨單,
So that 碼頭人員可以處理回廠退貨。

**Acceptance Criteria:**

**Given** 運務人員在運務APP送出退貨類型為「回廠退」的異常回報
**When** 系統接收異常回報資料
**Then** 於【後台>退貨單列表】建立該筆退貨單紀錄，並帶入該筆異常回報內容顯示
**And** 記錄當天日期為退貨單建立日期
**And** 產生退貨單號規則：B+yyyymmdd+00001（流水號）
**And** 預設退貨單狀態為「未完成」
**And** 送出退貨單後，運務APP修改內容不回寫至後台、碼頭前台的退貨單

### Story 11.4: 直退配送單自動建立

As a 系統,
I want 在運務送出直退異常回報時自動建立配送單,
So that 直退可以直接進入配送流程。

**Acceptance Criteria:**

**Given** 運務人員在運務APP送出退貨類型為「直退」的異常回報
**When** 系統接收異常回報資料
**Then** 退貨單狀態為「已立單」
**And** 【配送單管理>配送單管理】直接產生配送單
**And** 配送單欄位自動帶入：
  - 作業類型*：固定為「退貨作業」
  - 客戶簡稱*：帶入後台【派車任務管理>異常回報】該筆異常回報的[客戶簡稱]欄位
  - 配送溫層*：帶入後台【碼頭管理>退貨單列表】該直退退貨單關聯之原配送單溫層
  - 選擇退貨單：帶入該筆直退退貨單單號
  - 配送起點*：帶入後台【派車任務管理>異常回報】該筆異常回報的[起/迄點]欄位
  - 取貨日期*：帶入後台【碼頭管理>退貨單列表】該直退退貨單建立日期
  - 商品資訊*：帶入後台【派車任務管理>異常回報】該筆異常回報的商品資訊
  - 檔案上傳：帶入後台【派車任務管理>異常回報】該筆異常回報的[單據及照片上傳]欄位
  - 備註：帶入「退貨」兩字+後台【派車任務管理>異常回報】該筆異常回報的[備註]欄位
  - 配送迄點*：帶入運務APP【配送任務>趟次別>配送點>異常回報-退貨】該直退退貨單所選擇的退貨迄點
  - 配送日期*：帶入後台【碼頭管理>退貨單列表】該直退退貨單建立日期
