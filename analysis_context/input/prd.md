---
stepsCompleted: ['step-01-init', 'step-02-discovery', 'step-03-success', 'step-04-journeys', 'step-05-domain', 'step-06-innovation', 'step-07-project-type', 'step-08-scoping', 'step-09-functional', 'step-10-nonfunctional', 'step-11-polish']
inputDocuments: 
  - 'c:\\Users\\TingYi\\Downloads\\composer.json'
  - 'c:\\Users\\TingYi\\Downloads\\Architecture.md'
workflowType: 'prd'
projectDocsCount: 2
briefCount: 0
researchCount: 0
brainstormingCount: 0
classification:
  projectType: Web App
  domain: Logistics & Supply Chain
  complexity: High
  projectContext: brownfield
---

# Product Requirements Document - 昶青_碼頭系統

**Author:** Muki
**Date:** 2026-01-27

## 專案概述

### 專案分類
- **專案類型：** Web App
- **領域：** 物流與供應鏈（Logistics & Supply Chain）
- **複雜度：** 高
- **專案情境：** Brownfield（擴展現有配送管理系統）

### 系統背景
本專案為「倉儲管理系統」，是現有「配送管理系統」的擴展模組。現有系統已包含：
- 客戶端（Web + App）
- 運務端 App
- 總後台

### 新增系統說明
**系統名稱：** 倉儲管理系統  
**主要使用者：** 倉儲人員  
**系統定位：** 與現有配送管理系統整合，提供倉儲作業的完整管理功能

---

## 核心功能需求（MVP）

### 1. 人員管理

#### 1.1 登入/登出功能
- **登入驗證**
  - 驗證後台帳號密碼
  - 若不符，跳燈箱提示：「帳號密碼輸入錯誤」
- **忘記密碼**
  - 提供忘記密碼按鈕
  - 點擊後跳出燈箱提示文字
  - 內容串接後台資料純顯示
- **會話管理**
  - 安全登出功能

### 2. 即時公告（兩個頁面）

#### 2.1 公告列表頁
- **篩選列**
  - 可勾選列表項目
  - 全部已讀功能（依照篩選條件）
  - 全部刪除功能（依照篩選條件）
- **列表功能**
  - 已讀功能
  - 刪除功能
  - 公告狀態標示（已讀/未讀）

#### 2.2 公告詳細頁
- **顯示內容**
  - 公告發送日期
  - 公告發送時間
  - 公告標題
  - 公告內容
- **操作功能**
  - 刪除功能
  - 返回列表功能

### 3. 出貨作業管理（1個頁面，三個功能區塊）

#### 3.1 篩選列
- **篩選欄位**
  - 出貨日期（日期選單）
  - 班別（下拉選單／早班、午班、晚班）
- **篩選範圍**
  - 只針對未排車次列表進行篩選

#### 3.2 碼頭儀錶板
- **碼頭顯示規則**
  - 一個碼頭一組
  - 碼頭來源：抓【碼頭管理 > 碼頭列表】依照【碼頭管理 > 碼頭人員列表】該登入者所屬廠區顯示啟用中的碼頭名稱
  - 所屬廠區相同的人員使用相同碼頭儀錶板
  - 碼頭儀錶板底色固定顯示為綠色
- **未排車次時碼頭下拉選單**
  - 未排車次的碼頭名稱下方顯示[選擇車次]（下拉選單／[車牌]([車次])([任務單號])）
  - 車次定義：抓【配送點管理 > 固定路線】該路線別所設之車次代號
  - **選項條件（3 項皆須符合，符合時任務狀態為「待出貨」）：**
    - 當天配送日期
    - 任務起點的內部廠區 = 登入者所屬的內部廠區
    - 該任務有任何一筆送貨（不分載具、商品）
  - 選擇車次加入該碼頭後，該車輛任務狀態改為「碼頭處理中」
- **車輛操作**
  - 已排車次的碼頭名稱旁顯示通知圖示，點擊發送自動通知給該車次配送任務的運務員
  - 可點擊排入碼頭的車次開啟車次詳細資訊燈箱
- **燈箱功能**
  - 碼頭標題文字帶入該碼頭名稱
  - 依照所選車號抓【派車任務管理 > 配送任務】該筆配送任務資料顯示：
    - 上班時間
    - 司機姓名
    - [車號]([車次])
    - 路線別
  - **配送資訊：**
    - 顯示所選車號的配送任務內所有[配送點簡稱]+[地址]
    - 所有配送點資料預設收合，點擊時展開：顯示該配送點不同貨主的收送貨商品、載具詳細資訊
    - 各配送單預設收合，點擊時展開顯示：
      - 客戶簡稱
      - 配送單號
      - 聯絡人
      - 電話
      - 配送商品資訊
      - 配送載具資訊
      - 收貨備註（配送起點）
      - 送貨備註（配送迄點）
  - **車次狀態修改（綁定配送任務狀態）：**
    - [完成出車]按鈕：
      - 車輛任務狀態改為「配送中」
      - 從碼頭儀錶板、未排車次列表移除不再顯示
      - 關閉燈箱，回到出貨作業頁面
    - [取消]按鈕：
      - 車輛任務狀態改為「配送中」
      - 從碼頭儀錶板、未排車次列表移除不再顯示
      - 關閉燈箱，回到出貨作業頁面
    - [缺貨待料]按鈕：
      - 車輛任務狀態改為「缺貨待料」
      - 車次底色改為藍色
      - 從碼頭儀錶板移除，但顯示於未排車次列表
      - 關閉燈箱，回到出貨作業頁面
    - [通知未到]按鈕：
      - 車輛任務狀態改為「通知未到」
      - 車次底色改為紅色
      - 從碼頭儀錶板移除，但顯示於未排車次列表
      - 關閉燈箱，回到出貨作業頁面
      - 發送自動通知給該車次配送任務的運務員及運務部主管

#### 3.3 未排車次列表
- **顯示格式**
  - 純顯示／[車牌]([車次])([任務單號])
- **顯示條件**
  - 依照篩選條件顯示
  - 任務起點的內部廠區 = 登入者所屬的內部廠區
  - 該任務有任何一筆送貨
  - 車次定義：抓【配送點管理 > 固定路線】該路線別所設之車次代號
- **不顯示條件**
  - 不顯示任務狀態為「碼頭處理中」、「配送中」、「配送異常」、「配送完成」的車輛
- **顏色狀態（依車輛任務狀態區分）**
  - 綠色：待出貨
  - 藍色：缺貨待料
  - 紅色：通知未到

### 4. 收貨作業管理（3個頁面）

#### 4.1 收貨列表頁
- **篩選列**
  - 可設定篩選條件
- **列表顯示**
  - 依照篩選條件顯示任務內含有"收貨"的配送單的所有任務
- **下貨狀態**
  - 預設：接貨中
  - 運務回報[回廠下貨]後，狀態變為：回廠下貨
  - 回廠下貨時可追蹤該任務中車輛顯示回報位置和時間
- **下貨碼頭選擇**
  - 回廠下貨時可用下拉選單選擇下貨碼頭
  - 選項須自動排除已選定出貨和下貨的碼頭
- **導航功能**
  - 可點擊列表欄位-車號進入該任務的配送點總表
- **列表排序**
  - 依照狀態排序：先回廠下貨再接貨中
  - 同樣狀態依回報時間新到舊排序

#### 4.2 配送點總表
- **顯示內容**
  - 該任務所有有"收貨"配送單的客戶
  - 配送點
  - 收貨類型（入庫分貨／越庫作業，於後台配送任務建立當下即紀錄於資料庫，前台直接讀取顯示）
- **導航功能**
  - 點擊配送點可進入收貨明細（入庫分貨/越庫作業）
- **簽名板功能**
  - 針對整趟任務有簽名板讓運務簽名
  - 簽名送出後，列表頁該任務收貨狀態改為「下貨完成」
  - 下貨完成後不可再次進入收貨點總表

#### 4.3 收貨明細

##### 4.3.1 入庫分貨
- **時間顯示**
  - 顯示進入時間並持續動態更新
- **商品資訊列表**
  - 純顯示欄位：
    - 客戶簡稱
    - 商品名稱
    - 單據入數
    - 單據件數
    - 單據板位
- **實收數量**
  - 預設同單據入數
  - 可修改
  - 實收數量與有效日期單個商品可新增多組
  - 當有多組時可刪除（最少保留一組）
- **備註**
  - 一個商品一個供填寫

##### 4.3.2 越庫作業
- **時間顯示**
  - 顯示進入時間並持續動態更新
- **商品資訊列表**
  - 純顯示欄位：
    - 客戶簡稱
    - 商品名稱
    - 起點單據板位
  - 可填寫修改欄位：
    - 實收板位
    - 備註
  - 純顯示欄位：
    - 迄點單據板位
- **多組資料管理**
  - 配送點（下拉選單）、實收板位、配送日期與備註單個商品可新增多組
  - 當有多組時可刪除（最少保留一組）

### 5. 退貨作業管理

#### 5.1 退貨單列表頁
- **搜尋欄**
  - 關鍵字搜尋（退貨單號、原配送單號）
  - 建立日期（日期區間）
  - 客戶簡稱（搜尋下拉選單／單選／抓後台【客戶管理 > 客戶資訊】所有啟用的客戶簡稱）
  - 溫層（下拉選單／顯示基本溫層：冷藏／冷凍／常溫＋選定客戶簡稱後，抓選定客戶【商品管理 > 特殊溫層開通】有開通的所有特殊溫層）
  - 退貨類型（下拉選單／直退／回廠退／彙整單）
  - 狀態（下拉選單／未完成／已彙整／待立單／已立單）
- **[彙整退貨單]按鈕**
  - 將列表勾選的退貨單資料合併成一張退貨單顯示於列表（合併退貨商品資訊、備註與檔案上傳）
  - 判斷退貨單狀態必為「未完成」，且須同客戶簡稱與溫層才能夠合併
  - 若不符，跳提示文字：請選擇同客戶溫層的未完成退貨單
  - 單張退貨單也可以直接建立為彙整單
  - 產生退貨彙整單號規則：BA+yyyymmdd（退貨單建立日期）+00001（流水號）
  - 退貨彙整單類型顯示為「彙整單」，狀態為「待立單」
  - 被合併的原退貨單狀態變為「已彙整」
  - 顯示於碼頭前台退貨作業列表頁，並連動後台【碼頭管理 > 退貨單列表】顯示該筆退貨彙整單資料
- **列表顯示欄位**
  - 勾選格
  - 退貨單號（B/BA+yyyymmdd0000N）
  - 建立日期（yyyy/mm/dd）
  - 原配送單號（後台[新增]的退貨單、類型為「彙整單」的退貨單不顯示原配送單號欄位資料，直接留空）
  - 客戶簡稱
  - 溫層
  - 退貨類型（直退／回廠退／彙整單）
  - 狀態（未完成／已彙整／待立單／已立單）
- **顯示規則**
  - 若退貨類型為「直退」，只顯示任務起點內部廠區同登入者所屬廠區的退貨單
  - 若退貨類型為「回廠退」，只顯示退貨廠區同登入者所屬廠區的退貨單
- **操作按鈕**
  - **[編輯]按鈕**
    - 狀態為「未完成」時，進入退貨單編輯頁
    - 狀態為「待立單」時，進入彙整單編輯頁
  - **[查看]按鈕**
    - 狀態為「已彙整」且退貨類型為「回廠退」，進入退貨單查看頁
    - 狀態為「已立單」且退貨類型為「直退」，進入退貨單查看頁
    - 狀態為「已立單」且類型為「彙整單」，進入彙整單查看頁
- **排序規則**
  - 依建立日期由新到舊降冪排列
- **資料來源**
  - 運務APP【異常回報-退貨】產生的退貨單
  - 後台【碼頭管理 > 退貨單列表】的退貨單
  - 前後台合併「未完成」退貨單產生的彙整單

#### 5.2 退貨單編輯頁
- **純顯示欄位**
  - 退貨單號
  - 建立日期
  - 原配送單號
  - 客戶簡稱
  - 溫層
  - 退貨類型（必為「回廠退」）
  - 狀態（必為「未完成」）
- **退貨資料**
  - 品名
  - 退貨數量（數字框/自動帶入該商品的最小單位顯示）
  - 備註（文字段落）
- **[新增商品]按鈕**
  - 點擊跳出燈箱選擇商品
  - 燈箱同【配送單管理>新增頁】商品組燈箱
  - 依照客戶簡稱及溫層篩選可選擇的商品選項
- **[刪除]按鈕**
  - 藉[新增商品]按鈕新增的商品才可刪除
- **備註**（文字段落）
- **檔案上傳**
  - 多檔上傳
  - 預設帶入【後台>派車任務管理>異常回報】與原配送單號關聯的所有異常回報圖片檔案
  - 僅可上傳PDF、PNG、JPG檔
- **操作按鈕**
  - [返回]按鈕：點擊返回退貨作業列表頁
  - [儲存]按鈕：點擊跳出提示文字「儲存成功」，跳轉回退貨作業列表頁
- **資料連動**
  - 儲存時紀錄資料與【後台>退貨單列表】該筆資料相互連動顯示

#### 5.3 退貨單查看頁
- **純顯示欄位**
  - 退貨單號
  - 建立日期
  - 原配送單號
  - 客戶簡稱
  - 溫層
  - 退貨類型（「回廠退」或「直退」）
  - 狀態（回廠退必為「已彙整」；直退必為「已立單」）
- **退貨資訊**
  - 品名
  - 退貨數量
  - 備註
- **退貨備註**
- **檔案上傳**

#### 5.4 彙整單編輯頁
- **純顯示欄位**
  - 退貨單號
  - 建立日期
  - 原退貨單號
  - 客戶簡稱
  - 溫層
  - 退貨類型（必為「彙整單」）
  - 狀態（必為「待立單」）
- **退貨資料**（依後台【碼頭管理 > 退貨單列表】該筆彙整單資料顯示）
  - 品名
  - 退貨數量（數字框／自動帶入該商品的最小單位顯示）
  - 備註（文字段落／【後台 > 派車任務管理 > 退貨單列表 > 詳細頁】的備註內容）
- **[新增商品]按鈕**
  - 點擊跳出燈箱選擇商品
  - 燈箱同【配送單管理 > 配送單管理 > 新增頁】[新增商品組]燈箱顯示商品代號／商品名稱／商品簡稱
  - 依照客戶簡稱及溫層篩選可選擇的商品選項
- **[刪除]按鈕**（藉[新增商品]按鈕新增的商品才可刪除）
- **備註**（文字段落）
- **檔案上傳**
  - 多檔上傳
  - 預設帶入【後台 > 派車任務管理 > 異常回報】與原配送單號關聯的所有異常回報圖片檔案
  - 僅可上傳PDF、PNG、JPG檔
- **操作按鈕**
  - [返回]按鈕：點擊返回【碼頭系統 > 退貨作業列表頁】
  - [儲存]按鈕：點擊跳出提示文字「儲存成功」，跳轉回【碼頭系統 > 退貨作業列表頁】

#### 5.5 彙整單查看頁
- **純顯示欄位**
  - 退貨單號
  - 建立日期
  - 原退貨單號
  - 客戶簡稱
  - 溫層
  - 退貨類型（必為「彙整單」）
  - 狀態（必為「已立單」）
- **退貨資訊**
  - 品名
  - 退貨數量
  - 備註
- **退貨備註**
- **檔案上傳**

---

## 運務APP整合需求

### 6. 運務APP配送任務擴增

#### 6.1 回廠下貨功能
- **[回廠下貨]按鈕**
  - 判斷任務內配送單有送貨且已收貨完畢的趟次表才顯示
  - 點擊按鈕後顏色改變，顯示預設文字「碼頭確認中」
  - 待碼頭前台確認下貨碼頭後，文字改為「[該下貨碼頭名稱]」，不可再次點擊
- **後端連動**
  - 後台【倉儲收貨管理>倉儲收貨資訊查詢】該筆配送任務處理狀態變為「回廠下貨」
  - 碼頭前台【收貨作業列表】該筆配送任務狀態改為「回廠下貨」
  - 發送自動通知給任務迄點同所屬廠區的碼頭人員前台
  - 記錄當下時間為回報時間
  - 將當下經緯度資料轉為地址形式（串接Google Map API），紀錄顯示於碼頭前台【收貨作業列表】
  - 經緯度資料來源為衛星犬API

#### 6.2 異常回報 > 退貨
- **新增欄位**
  - 退貨類型*（單選/直退、回廠退）
  - 若選擇「回廠退」：顯示內部廠區*（下拉選單/抓【配送點管理>內部廠區】所有啟用的內部廠區名稱）
  - 若選擇「直退」：顯示退貨迄點*（下拉選單/抓【配送點管理>配送點列表】同所選客戶簡稱的配送點簡稱）
- **送出時處理**
  - 於【後台>退貨單列表】建立該筆退貨單紀錄，並帶入該筆異常回報內容顯示
  - 記錄當天日期為退貨單建立日期
  - 產生退貨單號規則：B+yyyymmdd+00001（流水號）
  - 退貨類型為「回廠退」，預設退貨單狀態為「未完成」
  - 退貨類型為「直退」，送出後【配送單管理>配送單管理】直接產生配送單，退貨單狀態為「已立單」
  - 送出退貨單後，運務APP修改內容不回寫至後台、碼頭前台的退貨單

#### 6.3 直退自動產生配送單
- **配送單欄位自動帶入**
  - 作業類型*：固定為「退貨作業」
  - 客戶簡稱*：帶入後台【派車任務管理>異常回報】該筆異常回報的[客戶簡稱]欄位
  - 配送溫層*：帶入後台【碼頭管理>退貨單列表】該直退退貨單關聯之原配送單溫層
  - 選擇退貨單：帶入該筆直退退貨單單號
  - 配送起點*：帶入後台【派車任務管理>異常回報】該筆異常回報的[起/迄點]欄位
  - 取貨日期*：帶入後台【碼頭管理>退貨單列表】該直退退貨單建立日期
  - 商品資訊*：帶入後台【派車任務管理>異常回報】該筆異常回報的商品資訊
  - 檔案上傳：帶入後台【派車任務管理>異常回報】該筆異常回報的[單據及照片上傳]欄位
  - 備註：帶入「退貨」兩字+後台【派車任務管理>異常回報】該筆異常回報的[備註]欄位
  - 配送迄點*：帶入運務APP【配送任務>趟次別>配送點>異常回報-退貨】該直退退貨單所選擇的退貨迄點
  - 配送日期*：帶入後台【碼頭管理>退貨單列表】該直退退貨單建立日期

---

## Domain-Specific Requirements

### Compliance & Regulatory

本專案為物流與供應鏈領域的倉儲管理系統，主要關注作業效率與資料準確性：

- **無特定法規要求：** 本系統不涉及特定法規遵循（如 FDA、HIPAA 等）
- **無特定審計要求：** 無外部審計或追溯要求
- **無特定資料保留期限：** 依一般業務需求保留資料

### Technical Constraints

#### 身份驗證與權限控制
- 登入/登出依照後台【碼頭管理 > 碼頭人員列表】建置資料進行驗證
- 登入後，依照該人員設定的內部廠區顯示符合該內部廠區的資料
- 確保資料隔離與權限控制

### Integration Requirements

#### 與現有系統整合
- 依後台現有資料設下規範或擴增
- 碼頭管理功能整合
- 碼頭人員列表整合
- 資料格式與通訊協定需與現有系統一致

#### 運務 APP 整合
- 推播通知機制：通知發送至運務 APP
- 狀態回報機制：運務 APP 回報「回廠下貨」狀態
- 資料同步：前後端即時資料同步

#### 資料規範
- 資料格式：依後台現有資料格式規範
- API 設計：RESTful API，與現有系統保持一致
- 訊息佇列：如需要，使用現有訊息佇列機制

### Risk Mitigations

#### 資料不一致風險
**風險描述：**
- 多系統資料不同步
- 狀態變更未即時反映
- 資料遺失或錯誤

**緩解策略：**
- 即時同步機制：確保即時性與可靠性
- 資料驗證：狀態變更前後進行資料驗證
- 狀態變更記錄：所有狀態變更都有記錄，可追溯
- 資料完整性檢查：定期檢查資料完整性

#### 系統故障風險
**風險描述：**
- 系統當機或網路中斷
- 資料無法同步
- 操作無法完成

**緩解策略：**
- 容錯機制：具備斷線提示與容錯
- 離線提示：網路中斷時明確提示使用者
- 資料暫存：關鍵操作資料暫存，恢復後同步
- 系統監控：監控系統狀態，快速發現問題

#### 人為錯誤風險
**風險描述：**
- 操作人員誤操作
- 狀態設定錯誤
- 資料輸入錯誤

**緩解策略：**
- 狀態確認機制：關鍵操作需要確認（如完成出車、取消等）
- 操作記錄：所有操作都有記錄，可追溯
- 資料驗證：輸入資料進行驗證（如實收數量不能為負數）
- 權限控制：依照人員權限限制操作範圍

#### 權限與資料隔離風險
**風險描述：**
- 人員看到不屬於自己廠區的資料
- 權限設定錯誤
- 資料洩漏

**緩解策略：**
- 廠區資料隔離：登入後只顯示符合該人員內部廠區的資料
- 權限驗證：所有操作都進行權限驗證
- 操作記錄：記錄所有資料存取操作
- 定期審查：定期審查人員權限設定

#### 即時性風險
**風險描述：**
- 狀態更新延遲
- 通知未及時送達
- 多裝置資料不一致

**緩解策略：**
- 即時同步機制：確保即時同步
- 通知機制：推播通知確保及時送達
- 狀態檢查：定期檢查狀態一致性
- 重試機制：通知失敗時自動重試

#### 整合風險
**風險描述：**
- 與現有系統整合失敗
- 資料格式不一致
- API 變更影響

**緩解策略：**
- API 版本控制：使用 API 版本控制，避免變更影響
- 資料格式驗證：整合前驗證資料格式
- 錯誤處理：完善的錯誤處理機制
- 測試驗證：整合前充分測試驗證

### Domain Patterns

#### 物流與供應鏈領域最佳實踐
- 狀態機模式：使用明確的狀態機管理配送任務狀態（待出貨 → 碼頭處理中 → 配送中 → 配送完成；異常分支：缺貨待料、通知未到、配送異常）以及收貨狀態（接貨中 → 回廠下貨 → 下貨完成）
- 事件驅動架構：使用事件驅動模式確保狀態變更即時同步
- 資料追溯：所有操作都有記錄，可追溯整個流程
- 異常處理：明確的異常狀態定義與處理流程
- 多層架構：使用多層架構（列表 → 總表 → 明細）組織複雜資訊

---

## Web App Specific Requirements

### Project-Type Overview

本專案為 Web App 類型的倉儲管理系統，主要透過瀏覽器存取，需要即時同步、多裝置支援，以及觸控友善的介面設計。

### Technical Architecture Considerations

> **註：** 以下為技術架構建議，詳細技術決策請參考 Architecture 文件。

#### 應用程式架構

**建議：SPA (Single Page Application)**
- 需要即時雙向通訊及流暢的多模組切換體驗
- 集中式狀態管理，適合即時資料更新

#### 後端技術棧（基於現有系統）
- 延續現有配送管理系統技術棧

#### 瀏覽器支援

**支援範圍：通用現代瀏覽器**

**支援的瀏覽器與版本：**
- Chrome：最新 2 個主要版本
- Firefox：最新 2 個主要版本
- Safari：最新 2 個主要版本（iOS Safari 與 macOS Safari）
- Edge：最新 2 個主要版本

**不支援：**
- Internet Explorer（IE11 及以下）
- 過舊的瀏覽器版本

**測試策略：**
- 主要測試 Chrome 與 Safari（最常用）
- 其他瀏覽器進行相容性測試
- 使用 Babel 轉譯確保相容性

#### SEO 需求

**不需要 SEO** — 內部系統，需身份驗證才能存取，設定 `noindex` 即可。

### 前端需求
- 響應式設計，支援多裝置
- 即時資料更新（雙向即時通訊）
- 觸控友善介面（支援簽名板操作）

### 整合需求
- RESTful API 設計
- 訊息佇列整合（如需要）
- 現有權限系統整合

#### 即時性需求

**需要即時雙向通訊功能**

**核心需求：**
- 後台操作即時反映至前端（< 3 秒）
- 前端操作即時同步至後台與其他裝置
- 連線中斷時自動重連，並提供斷線提示與容錯處理

**即時功能範圍：**
- 碼頭儀錶板狀態更新
- 車輛任務狀態變更同步
- 收貨狀態更新
- 通知推送（運務 APP）

#### 無障礙性（Accessibility）

**等級：WCAG AA**（內部系統，不需 AAA 等級）

**實作重點：**
- 鍵盤導航：所有功能可透過鍵盤操作
- 螢幕閱讀器支援：適當的 ARIA 標籤
- 顏色對比：符合 WCAG AA 標準（4.5:1）
- 焦點指示：清楚的焦點視覺回饋
- 表單標籤：所有表單元素有適當標籤

### Responsive Design

**支援所有裝置類型**

**裝置支援：**
- 桌面：1920x1080 及以上解析度
- 平板：iPad、Android 平板（768px - 1024px）
- 手機：iPhone、Android 手機（320px - 767px）

**設計重點：**
- 觸控友善：按鈕與互動元素至少 44x44px
- 簽名板支援：觸控裝置的簽名板功能
- 響應式佈局：使用 Flexbox / Grid 實現響應式設計
- 斷點設計：
  - Mobile: < 768px
  - Tablet: 768px - 1024px
  - Desktop: > 1024px

**觸控操作：**
- 支援觸控手勢（滑動、點擊、長按）
- 簽名板觸控繪製
- 下拉選單觸控操作

### Performance Targets

> 詳見 [Non-Functional Requirements > Performance](#performance) 區段。

### Implementation Considerations

> **註：** 具體技術選型與工具決策請參考 Architecture 文件，此處僅列出 PRD 級別的技術需求。

#### 技術需求摘要
- **前端：** 組件化 SPA 框架，支援集中式狀態管理與即時通訊
- **即時通訊：** 支援雙向即時推送，具備自動重連與斷線容錯
- **權限路由：** 支援前端路由級別的權限控制

#### 開發與部署需求
- 支援開發環境熱重載與 API Mock
- 前後端可獨立部署
- 環境變數管理（開發、測試、正式環境）

#### 測試需求
- 前端：單元測試、組件測試、E2E 測試
- 後端：單元測試、API 測試、整合測試
- 跨瀏覽器與響應式設計相容性測試

---

## Project Scoping & Phased Development

### MVP Strategy & Philosophy

**MVP Approach：問題解決型 MVP（Problem-Solving MVP）**

**策略說明：**
本專案採用「問題解決型 MVP」策略，目標是解決倉儲人員目前面臨的核心問題：
- 核心問題：依賴 Excel 和電話追蹤，資訊分散、容易出錯、效率低下
- MVP 價值：提供完整的倉儲管理系統，完全取代 Excel/電話追蹤方式
- 驗證目標：證明系統能夠 100% 取代現有作業方式，達到 100% 系統使用率

**MVP 成功標準：**
- 所有核心功能正常運作
- 與現有系統完整整合
- 100% 系統使用率（取代 Excel/電話）
- 錯誤率 < 0.1%
- 系統可用性 > 99.9%

**資源需求：**
- 團隊規模：建議 3-5 人（前端、後端、測試）
- 技能需求：
  - 前端：SPA 框架、即時通訊、響應式設計
  - 後端：現有技術棧擴展、即時通訊
  - 整合：API 設計、系統整合經驗
- 開發時程：依團隊規模與複雜度評估（建議 3-6 個月）

### MVP Feature Set (Phase 1)

**核心使用者旅程支援：**
- ✅ 倉儲人員 - 日常作業成功路徑（完整支援）
- ✅ 倉儲人員 - 異常處理路徑（完整支援）
- ✅ 後台管理員 - 系統管理路徑（部分支援，部分暫緩）
- ✅ 運務人員 - 協作互動路徑（透過運務 APP 整合）

**Must-Have Capabilities（MVP 必須功能）：**

#### 1. 人員管理（必須）
- 登入/登出功能（依後台碼頭人員列表驗證）
- 忘記密碼功能
- 廠區資料隔離（依人員內部廠區顯示資料）

#### 2. 即時公告（必須）
- 公告列表頁（篩選、已讀、刪除）
- 公告詳細頁
- 全部已讀/刪除功能

#### 3. 出貨作業管理（必須）
- 篩選列（出貨日期、班別，針對未排車次列表）
- 碼頭儀錶板（即時狀態、底色固定綠色、車次選擇下拉選單）
- 未排車次列表（篩選、依任務狀態顏色區分）
- 車輛任務狀態管理（綁定配送任務狀態：完成出車→配送中、取消→配送中、缺貨待料、通知未到）
- 通知機制（與運務 APP 整合）

#### 4. 收貨作業管理（必須）
- 收貨列表頁（篩選、狀態追蹤、碼頭選擇）
- 配送點總表（簽名板功能）
- 收貨明細（入庫分貨、越庫作業）
- 三層架構完整實作

#### 5. 退貨作業管理（必須）
- 退貨單列表頁（篩選、狀態顯示）
- 退貨單詳細頁（編輯/查看模式）

#### 6. 系統整合（必須）
- 與現有後台系統整合
- 與運務 APP 整合（推播通知、狀態回報）
- 資料即時同步機制

#### 7. 即時同步（必須）
- 即時雙向同步機制
- 狀態變更即時反映（< 3 秒）
- 多裝置同步支援

#### 8. 後台管理功能（部分必須）
- 碼頭管理主功能（碼頭列表、碼頭人員列表、退貨單列表）
- 倉儲收貨管理主功能（倉儲收貨資訊查詢）
- **暫緩：** 部分後台功能後續補充

**MVP 範圍邊界：**
- ✅ 包含所有 5 大核心功能模組
- ✅ 包含即時同步機制
- ✅ 包含與現有系統整合
- ❌ 不包含：進階報表、批量操作、AI 功能（這些屬於 Post-MVP）

### Post-MVP Features

#### Phase 2: Growth（成長階段）

**目標：** 提升效率與使用者體驗

**規劃功能：**
- **批量操作：**
  - 批量處理多個出貨/收貨任務
  - 批量狀態更新
  - 提升處理效率

- **進階搜尋與篩選：**
  - 進階搜尋功能
  - 多條件組合篩選優化
  - 搜尋結果排序與分頁優化

- **後台功能擴充：**
  - 完成暫緩的後台管理功能
  - 進階報表與分析功能
  - 資料統計與視覺化

- **效能優化：**
  - 前端效能優化（程式碼分割、懶載入）
  - 後端效能優化（資料庫優化、快取策略）
  - 即時同步效能優化

**成功指標：**
- 處理效率提升 30% 以上
- 使用者滿意度提升
- 系統穩定性進一步提升

#### Phase 3: Expansion（擴展階段）

**目標：** 創新功能與業務擴展

**規劃功能：**
- **AI 預測與優化：**
  - 排車建議
  - 異常預測
  - 效率優化建議

- **進階資料分析：**
  - 商業智慧報表
  - 趨勢分析
  - 預測分析

- **行動裝置 App：**
  - 倉儲人員專用 App（如需要）
  - 離線功能支援
  - 推播通知優化

- **其他創新功能：**
  - 自動化排車
  - 智慧碼頭分配
  - 其他業務需求

**成功指標：**
- 業務價值進一步提升
- 市場競爭力增強
- 使用者體驗持續優化

### Risk Mitigation Strategy

> 詳見 [Domain-Specific Requirements > Risk Mitigations](#risk-mitigations) 區段。

### Scope Decision Rationale

**為什麼所有功能都是 MVP？**

倉儲作業的出貨、收貨、退貨三大核心流程彼此關聯，缺少任一流程將無法完整取代現有 Excel/電話作業方式，無法達成 100% 採用率的驗證目標。同理，系統整合（後台＋運務 APP）、即時同步、異常處理等機制也是確保完整作業流程不可或缺的部分。

**MVP 範圍合理性驗證：**
- ✅ 所有功能皆為核心業務需求，支援核心使用者旅程
- ✅ 所有功能皆與成功標準直接相關
- ✅ 範圍明確，Post-MVP 功能（報表、批量操作、AI）有清楚區隔

---

## Success Criteria

### User Success

#### 登入體驗
- **登入失敗提示：** 燈箱提示在 1 秒內顯示
- **登入成功率：** > 99%
- **忘記密碼功能：** 燈箱內容載入時間 < 1 秒

#### 即時公告
- **公告列表載入：** < 2 秒
- **全部已讀/刪除操作：** 完成時間 < 3 秒
- **公告詳細頁載入：** < 1 秒

#### 出貨作業
- **碼頭儀錶板狀態更新：** 延遲 < 3 秒
- **車輛任務狀態變更反映：** 顏色更新即時反映（< 1 秒）
- **未排車次列表篩選：** 響應時間 < 500ms
- **下拉選單載入：** < 500ms
- **燈箱顯示：** < 500ms

#### 收貨作業
- **收貨列表排序與篩選：** 響應時間 < 1 秒
- **簽名板操作：** 完成時間 < 10 秒
- **收貨明細資料儲存：** 成功率 > 99.9%
- **收貨明細頁面載入：** < 2 秒

#### 退貨作業
- **退貨單列表載入：** < 2 秒
- **編輯操作響應：** < 500ms
- **詳細頁載入：** < 1 秒

### Business Success

#### 效率提升
- **碼頭閒置時間降低：** 目標降低 30% 以上
- **每日處理車次量提升：** 目標提升 20% 以上
- **出貨作業時間縮短：** 目標縮短 25% 以上

#### 錯誤率降低
- **排車錯誤率：** < 0.1%
- **收貨資料錯誤率：** < 0.1%
- **資料輸入錯誤率：** < 0.5%

#### 系統採用率
- **系統使用率：** 目標 100%（完全取代 Excel/電話追蹤）
- **完全取代時間：** 上線後 3 個月內達成 100% 採用

#### 溝通成本降低
- **確認電話/訊息次數減少：** 目標減少 80% 以上
- **人工確認時間減少：** 目標減少 70% 以上

### Technical Success

#### 即時同步
- **後台操作反映時間：** < 3 秒
- **狀態變更同步準確率：** 100%
- **多裝置同步支援：** 支援同時多裝置監控

#### System Performance

> 具體性能指標詳見 [Non-Functional Requirements > Performance](#performance) 區段。系統須達成所有 NFR 定義的性能標準。

#### 系統可用性
- 系統可用性：> 99.9%
- 錯誤率：< 0.1%
- 系統穩定性：支援多裝置同時監控，具備斷線提示與容錯

#### 資料一致性
- 與現有系統資料同步準確率：100%
- 資料遺失率：0%
- 資料完整性：100%

### Measurable Outcomes

#### 關鍵績效指標（KPI）
- **API 回應延遲：** 95% 請求 < 300ms
- **前端同步延遲：** 更新在 3 秒內可見
- **排車錯誤率：** < 0.1%
- **系統可用性：** > 99.9%
- **使用者採用率：** 上線 3 個月內達 100%
- **資料同步準確率：** 100%（與現有系統一致）

#### 使用者體驗指標
- **頁面載入時間：** < 2 秒
- **操作響應時間：** < 500ms
- **狀態更新延遲：** < 3 秒
- **登入成功率：** > 99%

---

## Product Scope

### MVP - Minimum Viable Product

> 詳見 [Project Scoping & Phased Development > MVP Feature Set](#mvp-feature-set-phase-1) 區段。

### Growth Features (Post-MVP)

> 詳見 [Project Scoping & Phased Development > Post-MVP Features](#post-mvp-features) 區段。

---

## User Journeys

### 旅程 1：倉儲人員 - 日常作業成功路徑

**角色：** 倉儲人員（主要使用者）  
**情境：** 典型工作日的完整作業流程

#### Opening Scene（開場場景）

早上 8:00，倉儲人員阿明抵達倉庫，準備開始一天的工作。過去，他需要翻閱 Excel 表格、打電話確認車次，資訊分散且容易出錯。現在，他只需要開啟倉儲管理系統。

#### Rising Action（上升行動）

**步驟 1：登入與總覽**
- 阿明登入系統，驗證後台帳號密碼
- 系統載入出貨作業當日車次、收貨作業列表、退貨作業列表
- 一眼即辨：立即掌握所有待處理任務的狀態

**步驟 2：出貨作業 - 排車與通知**
- 阿明查看碼頭儀錶板，看到未排車次的碼頭
- 從下拉選單選擇符合條件的車次（當天配送日期、任務起點為同廠區、該任務有任何一筆送貨，任務狀態為「待出貨」）
- 選擇車次加入碼頭後，該車輛任務狀態改為「碼頭處理中」
- 點擊碼頭旁通知圖示，通知發送至該車次配送任務的運務員
- 司機收到通知後進入碼頭，依照任務內配送單上貨
- 阿明點擊排入碼頭的車次，開啟車次詳細資訊燈箱，查看配送任務資料與所有配送點的收送貨商品、載具詳細資訊
- 依照車輛與上貨狀態，修改車輛任務狀態（完成出車→配送中／取消→配送中／缺貨待料／通知未到）
- 選擇「完成出車」後，任務狀態改為「配送中」，車輛從碼頭儀錶板與未排車次列表移除

**步驟 3：收貨作業 - 安排與確認**
- 阿明查看收貨作業列表，確認收貨任務資訊
- 當下貨狀態變為「回廠下貨」時（運務透過運務 APP 回報），系統顯示車輛回報位置和時間
- 阿明選擇車輛回廠的碼頭（系統自動排除已選定出貨和下貨的碼頭）
- 選定後通知司機，司機回廠後
- 阿明進入收貨明細，核對並修改收貨商品數量
- 確認收貨後，請司機於收貨點總表簽名送出
- 簽名送出後，列表頁該任務收貨狀態改為「下貨完成」
- 入庫分貨貨品入庫完成，越庫作業繼續後續配送

**步驟 4：退貨作業**
- 阿明查看退貨作業列表，確認退貨單資訊
- 對於狀態為「未完成」的退貨單，可點擊編輯進入詳細頁修改
- 對於狀態為「已立單」的退貨單，可點擊查看進入詳細頁（唯讀）

#### Climax（關鍵時刻）

當天下午，所有有送貨但未出車的車輛都已處理完畢。阿明透過系統清楚看到：
- 所有碼頭狀態一目了然
- 所有收貨任務進度清楚
- 所有退貨單狀態明確
- 不需要打電話確認，不需要翻 Excel，所有資訊都在系統中即時同步

#### Resolution（解決方案）

一天結束時，阿明可以：
- 清楚看到所有已完成和待處理的任務
- 換班時，單一畫面清楚交代所有進度與異常
- 系統記錄所有操作，可追溯所有狀態變更
- 從原本的 Excel + 電話追蹤，完全轉換為系統化管理

**此旅程揭示的需求：**
- 登入驗證與會話管理
- 多模組總覽（出貨、收貨、退貨）
- 碼頭儀錶板即時狀態顯示
- 車輛選擇與排車流程
- 通知機制（與運務 APP 整合）
- 狀態變更與即時同步
- 收貨作業三層架構（列表→總表→明細）
- 簽名板功能
- 退貨單管理

---

### 旅程 2：倉儲人員 - 異常處理路徑

**角色：** 倉儲人員  
**情境：** 處理缺貨待料與通知未到等異常情況

#### Opening Scene（開場場景）

阿明正在處理出貨作業，突然發現未排車次列表中某個車次顯示藍色（缺貨待料）或紅色（通知未到）。過去，他需要打電話確認、翻找資料，現在可以直接在系統中處理。

#### Rising Action（上升行動）

**步驟 1：發現異常**
- 阿明在未排車次列表看到異常狀態的車次（藍色：缺貨待料，紅色：通知未到）
- 顏色即時反映任務狀態，一眼即辨問題所在

**步驟 2：處理異常**
- 阿明點擊異常碼頭，跳出燈箱顯示該任務內含的所有配送單資訊
- 在燈箱中選擇「缺貨待料」或「通知未到」按鈕
- 車輛任務狀態立即更改，車輛從碼頭移除回到未排車次列表
- 未排車次列表中顏色隨任務狀態更改（缺貨待料：藍色，通知未到：紅色）

**步驟 3：重新排車**
- 當缺貨問題解決或司機到達後，阿明可以再次從下拉選單選擇該車輛
- 重新排車流程與正常流程相同
- 系統記錄所有狀態變更，可追溯處理過程

**步驟 4：手動修正**
- 如果系統顯示的資訊與實際不符，阿明可以手動修正
- 透過燈箱功能修改車輛狀態
- 修正後狀態立即同步，所有相關人員看到最新狀態

#### Climax（關鍵時刻）

過去，異常處理需要：
- 打電話確認情況
- 手動更新 Excel
- 通知相關人員
- 容易遺漏或出錯

現在，異常處理：
- 系統即時顯示異常狀態
- 一鍵修改狀態
- 自動同步所有相關人員
- 資訊同步不斷更新，只要查看系統就可知道狀況

#### Resolution（解決方案）

異常情況得到快速處理：
- 缺貨待料：問題解決後可重新排車
- 通知未到：司機到達後可重新排車
- 所有狀態變更都有記錄，可追溯
- 系統持續同步，確保資訊準確

**此旅程揭示的需求：**
- 異常狀態視覺化（顏色區分）
- 異常處理流程（燈箱修改狀態）
- 狀態變更即時同步
- 異常恢復機制（重新排車）
- 手動修正功能
- 狀態變更記錄與追溯

---

### 旅程 3：後台管理員 - 系統管理路徑

**角色：** 後台管理員（總後台）  
**情境：** 管理碼頭、人員與監控系統運作

#### Opening Scene（開場場景）

後台管理員小華需要管理整個倉儲系統的運作，包括碼頭設定、人員管理、資料查詢等。過去，這些功能分散在不同系統，現在整合在總後台中。

#### Rising Action（上升行動）

**步驟 1：碼頭管理**
- 小華進入後台，看到新增的「碼頭管理」主功能
- 包含次功能：
  - **碼頭列表：** 管理所有碼頭資訊
  - **碼頭人員列表：** 管理碼頭人員權限與設定
  - **退貨單列表：** 查看與管理所有退貨單

**步驟 2：倉儲收貨管理**
- 小華進入「倉儲收貨管理」主功能
- 包含次功能：
  - **倉儲收貨資訊查詢：** 查詢所有收貨作業的詳細資訊
  - 連動前台資料顯示，可同步查看修改資料

**步驟 3：資料同步監控**
- 小華可以同步查看前台的所有資料
- 系統即時同步，後台操作即時反映在前端
- 可追蹤所有狀態變更與操作記錄

#### Climax（關鍵時刻）

小華發現某個碼頭的收貨作業有異常，透過後台的「倉儲收貨資訊查詢」功能，立即看到：
- 該任務的所有收貨明細
- 收貨狀態與進度
- 運務回報的位置與時間
- 可以即時了解情況，不需要打電話詢問

#### Resolution（解決方案）

後台管理員可以：
- 統一管理所有碼頭與人員
- 即時查詢所有收貨資訊
- 監控系統運作狀態
- 所有資料與前台同步，確保一致性

**此旅程揭示的需求：**
- 後台碼頭管理功能（碼頭列表、碼頭人員列表、退貨單列表）
- 後台倉儲收貨管理功能（倉儲收貨資訊查詢）
- 前後台資料同步機制
- 資料查詢與監控功能

**註：** 部分後台功能暫緩，後續補充

---

### 旅程 4：運務人員 - 協作互動路徑

**角色：** 運務人員（司機，透過運務 APP）  
**情境：** 與倉儲系統協作完成配送任務

#### Opening Scene（開場場景）

運務人員阿強正在執行配送任務，過去需要透過電話與倉儲人員確認，現在透過運務 APP 與倉儲系統即時協作。

#### Rising Action（上升行動）

**步驟 1：接收出貨通知**
- 倉儲人員在碼頭系統選擇車次並通知司機
- 通知一律發送至該任務選定運務的運務 APP 推播
- 阿強收到推播通知，知道需要進入哪個碼頭
- 到達碼頭後，依照任務內配送單上貨

**步驟 2：回報回廠下貨**
- 阿強完成配送任務後，準備回廠下貨
- 運務 APP 新增「回廠下貨」按鈕
- 阿強點擊「回廠下貨」按鈕，回報碼頭前台該任務車輛下貨狀態為「回廠下貨」
- 倉儲人員立即在收貨作業列表中看到狀態變更

**步驟 3：收貨確認與簽名**
- 阿強回廠後，倉儲人員進入收貨明細核對收貨商品數量
- 倉儲確認收貨品項後，請運務簽名
- 阿強在收貨點總表的簽名板上簽名
- 簽名送出後，該任務收貨狀態變為「下貨完成」

#### Climax（關鍵時刻）

過去，運務與倉儲的協作需要：
- 多次電話確認
- 手動記錄狀態
- 容易遺漏或誤解

現在，協作流程：
- 即時推播通知
- 一鍵回報狀態
- 數位簽名確認
- 所有狀態自動同步

#### Resolution（解決方案）

運務人員可以：
- 即時接收出貨通知
- 快速回報回廠下貨狀態
- 數位簽名確認收貨
- 所有操作與倉儲系統即時同步

**此旅程揭示的需求：**
- 運務 APP 推播通知機制（與倉儲系統整合）
- 運務 APP「回廠下貨」按鈕功能
- 運務 APP 與倉儲系統的資料同步
- 簽名板功能（運務端操作）
- 前後端即時協作機制

---

### Journey Requirements Summary

> 各旅程所需功能需求詳見 [核心功能需求（MVP）](#核心功能需求mvp) 和 [Functional Requirements](#functional-requirements) 區段。

---

## Functional Requirements

### 能力領域 1：身份驗證與權限管理

- FR1: 倉儲人員可以使用後台帳號密碼登入系統
- FR2: 系統可以驗證登入憑證，並在驗證失敗時顯示錯誤提示
- FR3: 倉儲人員可以查看忘記密碼的相關資訊
- FR4: 倉儲人員可以安全登出系統
- FR5: 系統可以根據登入人員的內部廠區設定，只顯示符合該廠區的資料
- FR6: 系統可以整合後台碼頭人員列表進行身份驗證

### 能力領域 2：公告管理

- FR7: 倉儲人員可以查看公告列表
- FR8: 倉儲人員可以篩選公告列表
- FR9: 倉儲人員可以標記公告為已讀
- FR10: 倉儲人員可以刪除公告
- FR11: 倉儲人員可以批量標記公告為已讀（依照篩選條件）
- FR12: 倉儲人員可以批量刪除公告（依照篩選條件）
- FR13: 倉儲人員可以查看公告詳細內容（日期、時間、標題、內容）
- FR14: 系統可以顯示公告的已讀/未讀狀態

### 能力領域 3：出貨作業管理

- FR15: 倉儲人員可以查看碼頭儀錶板，顯示所屬廠區啟用中碼頭的即時狀態（碼頭來源：【碼頭管理 > 碼頭列表】，底色固定綠色）
- FR16: 所屬廠區相同的碼頭人員使用相同碼頭儀錶板
- FR17: 倉儲人員可以從未排車次的碼頭下拉選單中選擇車次（格式：[車牌]([車次])(任務單號)，車次抓【配送點管理 > 固定路線】該路線別所設之車次代號）
- FR18: 系統可以根據條件篩選可選車次（3 項皆須符合：當天配送日期、任務起點為同廠區、該任務有任何一筆送貨），符合時任務狀態為「待出貨」
- FR19: 倉儲人員選擇車次加入碼頭後，系統將該車輛任務狀態改為「碼頭處理中」
- FR20: 倉儲人員可以點擊已排車次開啟車次詳細資訊燈箱，顯示配送任務資料（上班時間、司機姓名、車號車次、路線別）及所有配送點的收送貨商品與載具詳細資訊
- FR21: 倉儲人員可以在燈箱中修改車輛任務狀態，狀態綁定配送任務狀態：完成出車（→ 配送中）、取消（→ 配送中）、缺貨待料（→ 缺貨待料）、通知未到（→ 通知未到）
- FR22: 系統可以根據車輛任務狀態變更自動更新顯示（配送中的車輛從碼頭儀錶板與未排車次列表移除，缺貨待料／通知未到的車輛從碼頭移除但回到未排車次列表）
- FR23: 倉儲人員可以透過出貨日期和班別篩選未排車次列表
- FR24: 系統可以根據篩選條件動態更新未排車次列表（不顯示任務狀態為「碼頭處理中」、「配送中」、「配送異常」、「配送完成」的車輛）
- FR25: 系統可以根據車輛任務狀態以不同顏色顯示未排車次（綠色：待出貨、藍色：缺貨待料、紅色：通知未到）
- FR25.1: 已排車次的碼頭名稱旁顯示通知圖示，倉儲人員點擊可發送自動通知給該車次配送任務的運務員
- FR25.2: 點擊[通知未到]時，系統同時發送自動通知給該車次配送任務的運務員及運務部主管

### 能力領域 4：收貨作業管理

- FR26: 倉儲人員可以查看收貨列表，顯示所有包含收貨的任務
- FR27: 倉儲人員可以篩選收貨列表
- FR28: 系統可以追蹤任務的下貨狀態（接貨中、回廠下貨、下貨完成）
- FR29: 系統可以接收運務回報的「回廠下貨」狀態，並更新任務狀態
- FR30: 系統可以顯示回廠下貨任務的車輛回報位置和時間
- FR31: 倉儲人員可以為回廠下貨的任務選擇下貨碼頭
- FR32: 系統可以自動排除已選定出貨和下貨的碼頭選項
- FR33: 倉儲人員可以從收貨列表進入任務的配送點總表
- FR34: 系統可以依照狀態和回報時間排序收貨列表（先回廠下貨再接貨中，同樣狀態依回報時間新到舊）
- FR35: 倉儲人員可以查看配送點總表，顯示任務所有有收貨的配送單資訊
- FR36: 倉儲人員可以從配送點總表進入收貨明細
- FR37: 倉儲人員可以請運務在配送點總表簽名
- FR38: 系統可以在運務簽名送出後，將任務收貨狀態更新為「下貨完成」
- FR39: 系統可以防止收貨狀態為「下貨完成」的任務再次進入配送點總表
- FR40: 倉儲人員可以查看入庫分貨的收貨明細
- FR41: 倉儲人員可以查看越庫作業的收貨明細
- FR42: 系統可以顯示收貨明細的進入時間並持續動態更新
- FR43: 倉儲人員可以查看配送單的商品資訊（客戶簡稱、商品名稱、單據資訊等）
- FR44: 倉儲人員可以修改入庫分貨的實收數量
- FR45: 倉儲人員可以為入庫分貨的商品新增多組實收數量與有效日期
- FR46: 倉儲人員可以刪除入庫分貨商品的多組實收數量與有效日期資料（最少必須保留一組）
- FR47: 倉儲人員可以為入庫分貨的商品填寫備註
- FR48: 倉儲人員可以修改越庫作業的實收板位
- FR49: 倉儲人員可以為越庫作業的商品新增多組配送點、實收板位、配送日期與備註
- FR50: 倉儲人員可以刪除越庫作業商品的多組資料（配送點、實收板位、配送日期與備註），最少必須保留一組
- FR51: 倉儲人員可以為越庫作業的商品填寫備註

### 能力領域 5：退貨作業管理

#### 5.1 退貨單列表頁

- FR52: 倉儲人員可以查看退貨單列表，顯示運務APP【異常回報-退貨】產生的退貨單、後台【碼頭管理 > 退貨單列表】的退貨單、以及前後台合併「未完成」退貨單產生的彙整單
- FR53: 倉儲人員可以透過關鍵字（退貨單號、原配送單號）、建立日期、客戶簡稱、溫層、退貨類型、狀態篩選退貨單列表
- FR54: 系統可以顯示退貨單的關鍵資訊（退貨單號、建立日期、原配送單號、客戶簡稱、溫層、退貨類型、狀態）
- FR54.1: 退貨類型為「直退」時，只顯示任務起點內部廠區同登入者所屬廠區的退貨單
- FR54.2: 退貨類型為「回廠退」時，只顯示退貨廠區同登入者所屬廠區的退貨單
- FR54.3: 後台[新增]的退貨單及類型為「彙整單」的退貨單，不顯示原配送單號欄位資料
- FR54.4: 列表依建立日期由新到舊降冪排列

#### 5.2 彙整退貨單功能

- FR55: 倉儲人員可以勾選列表中的退貨單，點擊[彙整退貨單]將多筆合併為一張彙整單（合併退貨商品資訊、備註與檔案上傳）
- FR55.1: 系統驗證被勾選的退貨單狀態必為「未完成」，且須同客戶簡稱與溫層；若不符，跳提示文字
- FR55.2: 單張退貨單也可以直接建立為彙整單
- FR55.3: 彙整單號規則：BA+yyyymmdd（退貨單建立日期）+00001（流水號）
- FR55.4: 彙整單類型顯示為「彙整單」，狀態為「待立單」
- FR55.5: 被合併的原退貨單狀態變為「已彙整」
- FR55.6: 彙整單同步顯示於碼頭前台退貨作業列表頁及後台【碼頭管理 > 退貨單列表】

#### 5.3 退貨單編輯頁與查看頁

- FR56: 倉儲人員可以編輯狀態為「未完成」的退貨單（修改退貨數量、備註、新增／刪除商品、檔案上傳）
- FR56.1: 退貨數量自動帶入該商品的最小單位顯示
- FR56.2: [新增商品]燈箱依照客戶簡稱及溫層篩選可選擇的商品選項
- FR56.3: 僅透過[新增商品]新增的商品可刪除，原有商品不可刪除
- FR56.4: 檔案上傳預設帶入【後台 > 派車任務管理 > 異常回報】與原配送單號關聯的異常回報圖片，僅可上傳 PDF、PNG、JPG 檔
- FR56.5: 儲存時資料與後台【退貨單列表】該筆資料相互連動
- FR57: 倉儲人員可以查看退貨單（唯讀，進入退貨單查看頁）：狀態為「已彙整」且退貨類型為「回廠退」，或狀態為「已立單」且退貨類型為「直退」

#### 5.4 彙整單編輯頁與查看頁

- FR57.1: 倉儲人員可以編輯狀態為「待立單」的彙整單（修改退貨數量、備註、新增／刪除商品、檔案上傳）
- FR57.2: 彙整單退貨資料依後台【碼頭管理 > 退貨單列表】該筆彙整單資料顯示
- FR57.3: 備註預設帶入【後台 > 派車任務管理 > 退貨單列表 > 詳細頁】的備註內容
- FR57.4: [新增商品]燈箱顯示商品代號／商品名稱／商品簡稱，依客戶簡稱及溫層篩選
- FR58: 倉儲人員可以查看狀態為「已立單」且類型為「彙整單」的彙整單（唯讀）
- FR58.1: 系統可以整合運務 APP 和後台產生的退貨單資料

### 能力領域 6：即時同步與通知

- FR59: 系統可以即時同步後台操作到前端顯示（< 3 秒）
- FR60: 系統可以即時同步前端操作到後台和其他裝置
- FR61: 系統可以維持即時雙向連線，確保資料即時同步
- FR62: 系統可以在網路中斷時提示使用者
- FR63: 系統可以支援多裝置同時監控並保持資料同步
- FR64: 系統可以發送推播通知到運務 APP
- FR65: 系統可以接收運務 APP 回報的狀態（如回廠下貨）

### 能力領域 7：後台管理

#### 7.1 碼頭管理 > 碼頭列表

- FR66: 後台管理員可以管理碼頭列表
- FR66.1: 系統提供碼頭列表頁面，包含搜尋功能（關鍵字搜尋碼頭名稱、所屬廠區下拉選單）
- FR66.2: 碼頭列表顯示欄位：所屬廠區、碼頭名稱、啟用狀態（ON/OFF）、操作（編輯/刪除）
- FR66.3: 點擊[新增]按鈕進入新增詳細頁
- FR66.4: 點擊[編輯]按鈕進入編輯詳細頁
- FR66.5: 判斷在【碼頭前台>出貨作業】與【碼頭前台>入庫作業】未曾安排過車次的碼頭才顯示[刪除]按鈕
- FR66.6: 點擊[刪除]按鈕跳出提示文字燈箱「是否確認刪除」，點擊[確定]後刪除
- FR66.7: 碼頭列表新增頁欄位：所屬廠區*（下拉選單/抓【配送點管理>內部廠區】所有啟用的內部廠區名稱）、碼頭名稱*（文字框）
- FR66.8: 碼頭列表編輯頁欄位同新增頁，預設帶入該碼頭現有資料

#### 7.2 碼頭管理 > 碼頭人員列表

- FR67: 後台管理員可以管理碼頭人員列表
- FR67.1: 系統提供碼頭人員列表頁面，包含搜尋功能（關鍵字搜尋人員姓名/人員帳號、所屬廠區下拉選單）
- FR67.2: 碼頭人員列表顯示欄位：人員姓名、人員帳號、所屬廠區、啟用狀態（ON/OFF）、操作（編輯/刪除）
- FR67.3: 點擊[新增]按鈕進入新增詳細頁
- FR67.4: 點擊[編輯]按鈕進入編輯詳細頁
- FR67.5: 未曾登入過的碼頭人員才顯示[刪除]按鈕
- FR67.6: 點擊[刪除]按鈕跳出提示文字燈箱「是否確認刪除」，點擊[確定]後刪除
- FR67.7: 碼頭人員新增頁欄位：所屬廠區*（下拉選單）、碼頭人員姓名*（文字框）、碼頭人員帳號*（文字框）、碼頭人員密碼*（文字框/隱碼顯示）、碼頭人員確認密碼*（文字框/隱碼顯示）
- FR67.8: 碼頭人員編輯頁欄位：所屬廠區*、碼頭人員姓名*、碼頭人員帳號*、碼頭人員密碼（選填/不顯示原密碼）

#### 7.3 碼頭管理 > 退貨單列表

- FR68: 後台管理員可以查看退貨單列表
- FR68.1: 退貨單列表搜尋欄位：關鍵字（退貨單號、原配送單號）、建立日期（日期區間）、客戶簡稱（搜尋下拉選單）、溫層（下拉選單/冷藏/冷凍/常溫+特殊溫層）、退貨類型（下拉選單/直退/回廠退/彙整單）、退貨廠區（下拉選單）、狀態（下拉選單/未完成/已彙整/待立單/已立單）、退貨配送單狀態（下拉選單）
- FR68.2: 退貨單列表顯示欄位：勾選格、退貨單號、建立日期、原配送單號、客戶簡稱、溫層、退貨類型、退貨廠區、狀態、退貨配送單號、退貨配送單狀態、操作
- FR68.3: 列表顯示運務APP【異常回報-退貨】產生的直退&回廠退退貨單、後台新增之回廠退退貨單、前後台合併未完成退貨單產生的彙整單
- FR68.4: 點擊[彙整退貨單]按鈕將勾選的退貨單合併成一張彙整單（須同退貨廠區、同客戶簡稱、同溫層）
- FR68.5: 彙整單號規則：BA+yyyymmdd+00001（流水號）
- FR68.6: 被合併的原退貨單狀態變為「已彙整」
- FR68.7: 狀態為「未完成」顯示[編輯]按鈕（進入退貨單編輯頁）；狀態為「待立單」顯示[編輯]按鈕（進入彙整單編輯頁）；狀態為「已彙整」或「已立單」顯示[查看]按鈕
- FR68.8: 退貨單新增頁欄位：客戶簡稱*（搜尋下拉選單）、溫層*（下拉選單）、退貨類型（純顯示/回廠退）、退貨廠區*（下拉選單）、退貨資訊（新增商品組燈箱）、退貨單備註（文字段落）、檔案上傳（多檔上傳/限PDF、PNG、JPG）
- FR68.9: 退貨資訊表格欄位：商品名稱、退貨數量（數字框+最小單位）、備註
- FR68.10: 點擊[送出]時產生退貨單號規則：B+yyyymmdd+00001（流水號），預設狀態為「未完成」
- FR68.11: 退貨單編輯頁純顯示欄位：退貨單號、建立日期、原配送單號、客戶簡稱、溫層、退貨類型、退貨廠區、狀態
- FR68.12: 退貨單查看頁顯示完整退貨單資訊（純顯示，不可編輯）
- FR68.13: 彙整單編輯頁顯示原退貨單號（純顯示），退貨資訊預設帶入原退貨單商品（同商品合併）
- FR68.14: 彙整單查看頁顯示完整彙整單資訊（純顯示）

#### 7.4 倉儲收貨管理 > 倉儲收貨資訊查詢

- FR69: 後台管理員可以查詢倉儲收貨資訊
- FR69.1: 倉儲收貨資訊查詢搜尋欄位：關鍵字搜尋（配送任務單號）、回廠時間（日期區間）、收貨類型（下拉選單/入庫分貨or越庫作業）、收貨配送點（搜尋下拉選單）、收貨廠區（搜尋下拉選單）、客戶簡稱（搜尋下拉選單）、處理狀態（下拉選單/接貨中or回廠下貨or下貨完成）、收貨人員（搜尋下拉選單）
- FR69.2: 列表顯示欄位：回報時間、配送任務單號、類型、收貨配送點、收貨廠區、客戶簡稱、處理狀態、收貨人員、是否異動、操作
- FR69.3: 顯示所有配送任務中有「收貨」的配送單，相同配送任務一個貨主x配送點為一列
- FR69.4: 排序規則：先依照狀態排序（回廠下貨>接貨中>下貨完成），同樣狀態依照回報時間降冪排序
- FR69.5: 收貨類型於後台配送任務建立當下即紀錄於資料庫（入庫分貨／越庫作業），前台直接讀取顯示
- FR69.6: 處理狀態預設為「接貨中」，運務APP點擊[回廠下貨]後變為「回廠下貨」，碼頭前台簽名後變為「下貨完成」
- FR69.7: 是否異動預設為「否」，下貨完成後後台修改則記錄為「是」

#### 7.5 倉儲收貨資訊查詢 > 編輯（入庫分貨）

- FR69.8: 入庫分貨編輯頁純顯示欄位：回報時間、配送任務單號、類型（入庫分貨）、收貨廠區、收貨配送點、客戶簡稱、運務員簽名（圖檔）、處理狀態
- FR69.9: 收貨資訊表格欄位：品名、單據入數、單據件數、單據板位、實收數量（數字框）、有效日期（日期選單）、備註（文字框）
- FR69.10: 單據入數/件數/板位預設顯示運務APP配送單起點回報數值
- FR69.11: 單筆商品可新增多組[實收數量]+[有效日期]，超過一組才顯示刪除按鈕
- FR69.12: 原配送單內收貨商品不可刪除，後台新增商品才顯示刪除按鈕
- FR69.13: 儲存時收貨資訊連動【碼頭前台>收貨作業>入庫分貨詳細頁】顯示

#### 7.6 倉儲收貨資訊查詢 > 編輯（越庫作業）

- FR69.14: 越庫作業編輯頁純顯示欄位同入庫分貨
- FR69.15: 收貨資訊表格欄位：商品名稱、起點單據板位、實收板位（數字框）、備註（文字框）、迄點單據板位、配送點（搜尋下拉選單）、實收板位、配送日期（日期選單）、備註
- FR69.16: 配送點下拉選單抓【配送點管理>常態配送點】與該客戶關聯所有啟用的常態配送點
- FR69.17: 可新增多筆商品項目，單一商品可新增多組配送點資料
- FR69.18: 原配送單內收貨商品不可刪除，後台新增商品才可刪除
- FR69.19: 儲存時收貨資訊連動【碼頭前台>收貨作業>越庫作業詳細頁】顯示

- FR70: 後台管理員可以同步查看前台資料
- FR71: 後台管理員可以修改前台資料（依照權限）

### 能力領域 8：資料整合與一致性

- FR72: 系統可以與現有後台系統整合資料
- FR73: 系統可以自動驗證與現有系統的資料同步結果，偵測並回報資料不一致
- FR74: 系統可以記錄所有狀態變更操作
- FR75: 系統可以追溯所有操作的歷史記錄
- FR76: 系統可以驗證資料完整性

### 能力領域 9：後台既有功能擴增

#### 9.1 網站管理 > 區塊內容管理 > 碼頭-忘記密碼

- FR77: 於[網頁忘記密碼]下方新增[碼頭-忘記密碼]設定區塊
- FR77.1: 碼頭-忘記密碼編輯頁欄位：內文*（文字段落）
- FR77.2: 內文內容串接碼頭前台登入頁忘記密碼燈箱顯示

#### 9.2 通知管理 > 通知列表 > 新增頁

- FR78: 通知列表新增頁發送類型新增兩種：全部碼頭人員、特定碼頭人員
- FR78.1: 選擇「特定碼頭人員」時顯示[選擇碼頭人員]按鈕
- FR78.2: 點擊[選擇碼頭人員]跳出燈箱，搜尋欄位：關鍵字搜尋（碼頭人員帳號/人員姓名/所屬廠區）
- FR78.3: 燈箱列表抓【碼頭管理>碼頭人員列表】所有啟用中的人員資訊，顯示：勾選欄位、人員帳號、人員姓名、所屬廠區
- FR78.4: 燈箱可多選發送對象
- FR78.5: 只有[訊息類型]選擇「站內信」時，才可選擇碼頭人員

#### 9.3 配送點管理 > 內部廠區 > 新增/編輯頁

- FR79: 內部廠區新增/編輯頁新增[入庫分貨配送點]按鈕
- FR79.1: 點擊[入庫分貨配送點]開啟燈箱
- FR79.2: 燈箱搜尋欄位：關鍵字搜尋（配送點代號、配送點簡稱、地址）、客戶簡稱（搜尋下拉選單）、區域（下拉選單/北區、中區、南區、東區、花東區）、班別（下拉選單/早班、午班、晚班）
- FR79.3: 燈箱列表顯示【配送點管理>配送點列表】所有配送點資料
- FR79.4: 燈箱列表欄位：勾選欄位、配送點代號、配送點簡稱、客戶簡稱、區域、班別、收/送貨地址
- FR79.5: 可勾選多筆配送點與內部廠區建立關聯
- FR79.6: 可取消勾選多筆配送點與內部廠區解除關聯
- FR79.7: 點擊[儲存]時顯示所選入庫分貨配送點

#### 9.4 配送單管理 > 配送單管理

- FR80: 配送單管理搜尋欄位新增：作業類型（下拉選單/配送作業/退貨作業）
- FR80.1: 列表新增欄位顯示[作業類型]，固定為：配送作業/退貨作業
- FR80.2: 現有資料皆帶入為配送作業
- FR80.3: 判斷作業類型為「退貨作業」時，不顯示[複製]按鈕及[編輯]按鈕

#### 9.5 配送單管理 > 配送單管理 > 新增頁

- FR81: 新增頁新增欄位：作業類型*（單選/配送作業、退貨作業）
- FR81.1: 作業類型預設選擇為「配送作業」
- FR81.2: 選擇「配送作業」同目前操作流程
- FR81.3: 選擇「退貨作業」顯示退貨作業專用欄位

#### 9.6 配送單管理 > 新增頁 - 退貨作業

- FR82: 退貨作業新增頁欄位：
  - 作業類型*（固定為退貨作業）
  - 客戶簡稱*（搜尋下拉選單）
  - 配送溫層*（下拉選單/冷藏(0-7度C)、冷凍(-18度C)、常溫+特殊溫層）
  - 選擇退貨單（燈箱）
  - 配送起點*（搜尋下拉選單/關聯該客戶的配送點）
  - 取貨日期*（日期套件）
  - 起點收貨商品（燈箱/預設帶入選擇退貨單的商品品項和入數）
  - 文件檔案（多檔上傳/預設帶入退貨單上傳的檔案）
  - 備註（文字段落/預設帶入「退貨」兩字及退貨單設定的備註內容）
  - 配送迄點*（搜尋下拉選單）
  - 配送日期*（日期套件）
  - 迄點送貨商品*（燈箱/預設帶入選擇退貨單的商品品項和入數）
- FR82.1: 客戶簡稱有編輯時清除配送溫層選擇的項目
- FR82.2: 可新增多個配送迄點
- FR82.3: 退貨作業沒有[暫存]按鈕功能
- FR82.4: 從退貨單帶入的商品不可修改，自行新增的商品才可以
- FR82.5: 起點收貨商品/迄點送貨商品表格欄位：送/收、商品名稱、入數（數字框+最小單位）、件數（數字框+中級單位）、單板件數、板位（自動計算）

#### 9.7 配送單管理 > 新增頁 - 退貨作業 > 退貨單燈箱

- FR83: 選擇退貨單燈箱搜尋欄位：關鍵字搜尋（退貨單號）、建立日期（日期區間）、退貨廠區（下拉選單）
- FR83.1: 燈箱列表依照所選客戶簡稱及溫層，顯示【碼頭管理>退貨單列表】狀態為「待立單」的彙整單資料
- FR83.2: 燈箱列表欄位：勾選欄位、退貨單號、建立日期、客戶簡稱、溫層、退貨廠區、商品資訊
- FR83.3: 可勾選多筆退貨彙整單建立退貨配送單資訊
- FR83.4: 商品資訊欄位點擊跳燈箱顯示該筆退貨單商品資訊（商品名稱、退貨數量、備註）
- FR83.5: 點擊[儲存]時配送單帶入所選退貨單的商品資訊、退貨單備註、檔案上傳

#### 9.8 退貨作業送出驗證

- FR84: 送出時判斷同一組起點中，同商品的起點、迄點總和：
  - 若相同：配送單管理單據狀態為「已送出」，配送單查詢狀態為「訂單確認中」
  - 若不同：跳警告燈箱文字顯示「[商品名稱]起點數量與迄點數量總和不相符，請重新調整」
- FR84.1: 將下單日期顯示為送出時的日期
- FR84.2: 將這筆退貨作業選到的彙整單於【後台>退貨單列表】、【碼頭前台>退貨作業_列表頁】狀態更新為已立單
- FR84.3: 將這筆配送單號回寫到【後台>退貨單列表】的退貨配送單號，同步顯示退貨配送單狀態

#### 9.9 配送單管理 > 查看頁

- FR85: 配送單查看頁新增顯示欄位：作業類型（配送作業or退貨作業）

---

## Non-Functional Requirements

### Performance（性能）

#### 響應時間要求
- API 響應時間：95% 請求 < 300ms
- 頁面載入時間：< 2 秒
- 互動操作響應時間：< 500ms
- 篩選與搜尋響應：< 500ms

#### 即時同步性能
- 後台操作反映時間：< 3 秒
- 狀態變更同步準確率：100%
- 即時連線穩定性：連線中斷率 < 0.1%
- 多裝置同步延遲：< 3 秒

#### 特定功能性能
- 碼頭儀錶板狀態更新：延遲 < 3 秒
- 車輛任務狀態變更反映：顏色更新即時反映（< 1 秒）
- 未排車次列表篩選：響應時間 < 500ms
- 收貨列表排序與篩選：響應時間 < 1 秒
- 簽名板操作：完成時間 < 10 秒

### Security（安全）

#### 身份驗證與授權
- 登入驗證：整合後台帳號密碼驗證系統
- 會話管理：安全登出功能，會話逾時自動登出
- 權限控制：整合現有權限系統，保持一致性
- 操作權限驗證：所有操作都進行權限驗證

#### 資料隔離與保護
- 廠區資料隔離：登入後只顯示符合該人員內部廠區的資料
- 資料存取控制：依照人員權限限制操作範圍
- 資料傳輸安全：所有資料傳輸使用加密（HTTPS/WSS）
- 敏感資料保護：簽名資料、操作記錄等敏感資訊需加密儲存

#### 安全審計
- 操作記錄：記錄所有狀態變更操作
- 審計日誌：可追溯所有操作的歷史記錄
- 定期審查：定期審查人員權限設定

### Reliability（可靠性）

#### 系統可用性
- 系統可用性：> 99.9%（每月停機時間 < 43.2 分鐘）
- 錯誤率：< 0.1%
- 系統穩定性：支援多裝置同時監控，具備斷線提示與容錯

#### 資料可靠性
- 與現有系統資料同步準確率：100%
- 資料遺失率：0%
- 資料完整性：100%
- 收貨明細資料儲存：成功率 > 99.9%

#### 容錯與恢復
- 網路中斷處理：網路中斷時提示使用者，並在恢復後自動重新連線
- 即時連線恢復：連線中斷時自動重連，確保資料不遺失
- 異常處理：提供異常處理流程與異常恢復機制
- 降級方案：即時通訊失敗時提供降級方案（如輪詢）

### Integration（整合）

#### 系統整合
- 後台系統整合：與現有後台系統完整整合資料
- 資料同步機制：確保即時性與可靠性
- API 整合：RESTful API 設計，支援標準 HTTP 方法
- 訊息佇列整合：如需要，支援訊息佇列整合

#### 外部系統整合
- 運務 APP 整合：接收運務 APP 回報的狀態（如回廠下貨）
- 推播通知整合：發送推播通知到運務 APP
- 資料格式相容：確保與現有系統的資料格式相容

#### 整合可靠性
- 整合穩定性：整合服務可用性 > 99.5%
- 資料一致性：確保所有整合系統的資料同步一致
- 錯誤處理：整合失敗時提供錯誤提示與重試機制
